{"version":3,"sources":["web/i18n/provider.js","web/i18n/index.js","web/ducks/app.js","web/lib/settings.js","web/lib/sdmx/annotations.js","web/lib/sdmx/structure.js","web/lib/sdmx/dataflows.js","web/lib/sdmx/hierarchy.js","web/lib/sdmx/index.js","web/lib/utils/index.js","web/selectors/vis.js","web/selectors/sdmx.js","web/ducks/vis.js","web/selectors/app.js","web/api/formatMapper.js","web/lib/excel/index.js","web/api/sdmx.js","web/ducks/sdmx.js","web/core/reducer.js","web/core/middlewares.js","web/core/store.js","web/theme/theme.js","web/theme/index.js","web/components/Error.js","web/hocs/withResponsiveness.js","web/components/FilterPeriod/index.js","web/components/FilterSelection/index.js","web/components/Filters/index.js","web/components/Lastnobs/index.js","web/components/DataflowNavigator/index.js","web/components/NarrowFilters/index.js","web/lib/layout/index.js","web/selectors/table.js","web/components/TableConfig/TableConfig.js","web/components/TableConfig/index.js","web/components/Toolbar/menus.js","web/components/Toolbar/actions.js","web/components/Toolbar/index.js","web/components/Tools/Tools.js","web/components/Tools/index.js","web/components/FooterUnicef/index.js","web/components/Table/Cell.js","web/components/ToolbarUnicef/menus.js","web/components/ToolbarUnicef/actions.js","web/components/ToolbarUnicef/index.js","web/components/TableMessageUnicef/index.js","web/components/Table/Table.js","web/components/Table/index.js","web/components/Chart/index.js","web/components/Viewer/config.js","web/components/Viewer/index.js","web/components/Footnotes/Footnotes.js","web/components/Footnotes/index.js","web/components/Main/Main.js","web/components/Main/index.js","web/components/HierarchicalCodelist/index.js","web/components/App/App.js","web/components/App/index.js","web/index.js","web/assets/data-explorer-logo.png"],"names":["Provider","_ref","localeId","messages","children","react_default","a","createElement","index_es","locale","key","React","Children","only","model","concat","setPending","id","is","type","payload","sdmx","R","window","SETTINGS","getDatasource","sdmxRange","sdmxPeriod","sdmxPeriodBoundaries","sdmxPeriodBoundariesMinMax","min","max","getSdmxAttribute","Array","chart","chartOptions","getIndicatorProfileUrl","isValidNumber","Number","NaN","getIsSelected","index","annotations","selection","Boolean","md5","sdmx_structure","structure","lang","dimensions","conceptSchemes","dataflow","codelists","getCodelists","getLocalisedName","getDataflow","agencyID","rest","Object","objectWithoutProperties","objectSpread","code","agencyId","name","acc","dimension","console","log","getConceptIdentity","conceptIdentity","getUrnToParse","conceptIdentityUrnToParse","conceptIdentityRepresentationCode","conceptScheme","_ref2","version","getSdmxId","sdmxId","getConceptScheme","getConcepts","concepts","getConcept","concept","getId","forced","getForcedDims","getLocalRepresentation","localRepresentation","getLink","i","length","value","getCodeList","_ref3","codes","getSortedCodes","parsedDimension","roles","conceptRoles","values","_ref4","parent","_ref4$annotations","parentId","isDefaultSelected","label","link","localisedCodes","toConsumableArray","getDimensions","ref","dsds","dsdId","split","agency","v","slice","dsd","filter","el","ret","dataStructureComponents","dimensionList","forEach","push","sdmx_dataflows","dataflowsParser","data","dataflows","element","df","dataStructures","isFinal","getReferencedCodeLabel","refCodelist","codelistAliasRef","codeID","getCodesHierarchy","c","hierarchicalCodes","urnToStructureId","urn","structureID","sdmx_hierarchy","hierarchyParser","hierarchicalCodelists","refCodelists","includedCL","includedCodelists","k","hasOwnProperty","strId","cl","hierarchy","hierarchies","h","node","getHierarchy","getConfig","_ref5","configArgs","Error","_R$prop4","datasourceId","dataflowId","datasource","isStructure","keyword","identifiers","dataquery","url","getDataUrl","_ref6","requestArgs","period","params","qs","stringify","startPeriod","endPeriod","addQueryPrefix","getFilename","greaterThanOne","getDimensionsIds","d","rules","isTimeDimension","getUniq","array1","array2","withIndex","keysMap","obj","dimensionFormats","dimensionValueDisplay","both","getVis","getPeriod","createSelector","getLastnobservations","getViewer","getAction","getDisplay","getFilter","getDataquery","getIsFullscreen","getTimeDimensionInverted","getLayout","getDimensionGetter","getDimensionFormat","getSdmx","getData","getDataflows","getVisDataquery","getCustomAttributes","format","flagsSet","Set","attrs","memo","rattr","attr","isFootnote","has","flags","footnotes","getFilters","filters","valueIdsSet","getSelection","CHANGE_DATAQUERY","changeViewer","viewerId","changeAction","actionId","changeDataflow","changeDataquery","filterId","valueId","dispatch","getState","getApp","getLocale","getPending","getIsPending","getIsRtl","addLinkAnnotation","cl_id","renameKey","object","oldKey","newKey","convertName2","map_struct_component","comp","getDimensionById","dims","updateIndex","dimval","__index","idxToString","idx","e","join","createDataRow","header","section","datarow","curated","obs","attribs","hidx","secidx","valIdx","rowDimVals","row","dataStartIdx","rowAttribs","dr","h2","headerIndex","sec","sectionIndex","valIndex","lev1","lev2","lev3","att","createFootnotes","changeCellStyle","cell","style","fill","pattern","fgColor","argb","isBold","bold","font","color","generateExcel","asyncToGenerator","regenerator_default","mark","_callee","layout","timeDimensionInverted","excel_styles","sections","rows","lastAttribKey","obs_keys","timeDim","timeSort","timeSortInv","layout2","datakeys","_i","_Object$entries","curLay","ExcelJS","rowLen","rowDimsLen","workbook","sheet","rnum","col_shift","r","buf","wrap","_context","prev","next","rowDim","rowDimValue","footnotesSection","observation","attributes","dataSets","observations","keys","o","oidx","vidx","keyPosition","find","b","start","sort","entries","slicedToArray","getCuratedData","getSortedLayout","require","sectionsData","headerData","Workbook","addWorksheet","addRow","getCell","s","sectionText","secHead","rowData","cellCount","note","f","xlsx","writeBuffer","sent","abrupt","stop","_x","_x2","_x3","apply","this","arguments","sdmxMapperDataflows","sdmxMapperHierarchy","methods","getStructure","_R$prop3","getFusionConfig","qStringParams","mode","references","acceptParam","Accept-Language","Accept","addForcedDims","struct","forcedDims","sdmxMapperStruct","meta","links","l","names","parents","add","size","axios","get","headers","then","structureParser","_getConfig","limitData","dataNode","limited","returnedKeyCount","limitedTo","lastnobservations","sdmxMapperData","dataset","series","dimensionAtObservation","v8Transformer","getDataFile","accept","backendId","responseType","response","blob","Blob","FileSaver","saveAs","_ref7","getDataflowsConfig","detail","includeMetadata","_ref8","ag","config","getHierarchyUrl","getExcelDataFile","_getConfig3","yStart","yEnd","main","_ref9","method","error","_ref10","_ref11","fn","request","ctx","pendingId","sdmxApi","res","catch","errorCode","statusCode","status","pushLog","requestData","shouldRequestStructure","undefined","Promise","resolve","requestStructure","dqParts","dimCodes","_loop","some","splice","cleanDataQueryAgainstStructure","document","getElementById","dispatchEvent","CustomEvent","nodata","nolayout","requestDataFile","isDownloadAllData","combineReducers","app","state","action","vis","isFullscreen","isTimeDimensionInverted","filterIndex","safeDataquery","requestDataMiddleware","future","withLogger","middlewares","Colors","Formats","theme","rtl","createMuiTheme","overrides","MuiButton","text","textTransform","palette","primary","mainAlpha","light","dark","contrastText","secondary","hover","selected","active","typography","fontFamily","raisedButton","textColor","primaryTextColor","default","backgroundColor","configLabelBG","configLabelCol","appSize","appMinSize","itemMinSize","scopeListContainer","maxHeight","scopeList","divider","direction","useNextVariants","configLabel","fontSize","configButtonRegular","fontWeight","configButtonSelected","panelSummary","panelIcon","configInputs","alert","table","yBg","yBgHover","yBgActive","yFontHeader","yFont","zBg","zBgHover","zBgActive","zFontHeader","zFont","xBg","xBgHeader","xBgHover","xBgActive","xFontHeader","xFont","oFont","sBg","jss","create","plugins","jssPreset","generateClassName","createGenerateClassName","isRtl","JssProvider_default","styles","muiTheme","glamorous_esm","mergeDeepRight","mainTheme","ErrorBoundary","props","_this","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","hasError","setState","build","isHome","title","logo","Component","Narrow","react_responsive_default","assign","query","Default","compose","connect","createStructuredSelector","changePeriod","withProps","titleLabel","tagLabel","periodBoundaries","options","labelStepSize","pure","DEFilterPeriod","items","changeFilters","clearAllLabel","blankLabel","noScroll","VXFiltersCurrent","Filter","VXScopeList","injectIntl","activePanelId","changeSelection","onChangeActivePanel","intl","optionsSpotlight","hasClearAll","mainPlaceholder","formatMessage","secondaryPlaceholder","spotlight","engine","spotlightScopeListEngine","placeholder","fields","vx.spotlight.field.label","accessor","isSelected","topElementComponent","VXSpotlight","parentProps","TopElementComponent","Lastnobs","className","checked","lastnobs","onChange","changeLastnobs","lastn","createLink","df_id","stickyDims","dq","dim","indexOf","sel","map","elem","dim_selection","location","href","isOnEvidence","on_evidence","selItems","toSort","onEvidence","df_keys","df_key","dataflowsOnEvidence","includes","actionText","indDim","ind","containsIndicators","NarrowFilters","isOpen","dateRangeIsOpen","_this2","toRender","onClick","components_Lastnobs","lastnobs_active","opacity","pointerEvents","FilterPeriod","isNarrow","FilterSelection","Filters","components_DataflowNavigator","defaultConcat","getValuesFlat","adjustment","notAvailableIds","withoutNotAvailableIds","pivot","defineProperty","prop","isInvalid","dimensionIds","layoutIds","hasInvalidIds","getDefaultLayout","many","getMissingIds","defaultLayout","ids","timeId","areaId","isAreaDimension","helper","omitIds","pickId","x","y","z","defaultLayoutBuilder","defaultMissingIds","getDataDimensions","getVisDataDimensions","one","getTableConfigDimensions","isOne","Layout","isTimePeriod","getVisTableConfigLayout","getVisLayout","structureDimensions","dataDimensions","Sdmx","visLayout","sdmxLayout","dimensionsIds","oneIds","missingIds","TableConfig","tableProps","noCollapse","dimensionGetter","changeLayout","changeGetter","changeIsTimeDimensionInverted","noPreview","labels","commit","cancel","column","time","asc","desc","help","dimensionGetters","menus","Toolbar_actions","changeActionId","actions","icon","filtersBtn","isDownloading","changeMenu","loadingActionId","selectedMenuId","selectedActionId","showLabel","DEVisualisationToolbar","Tools","isFilters","Fragment","Toolbar","isFull","noHeader","components_TableConfig","isChartConfig","FooterUnicef","showCopyrightSymbol","StyledCell","glamorous","div","width","height","padding","textAlign","isYLast","isXLast","borderTop","border","borderLeft","borderRight","borderBottom","Cell","renderObservation","variant","ToolbarUnicef_menus","ToolbarUnicef_actions","requestExcelDataFile","TableMessageUnicef","animationMillis","msgBoxId","addEventListener","remMessage","removeEventListener","setTimeout","onTransEnd","el2","display","classList","position","top","right","TableContainer","borderLeftWidth","borderRightWidth","marginTop","overflowX","Table","viewerConfig","itemFormatter","isNotATable","dotstatsuite_ui_header_lib_default","fonts","ToolbarUnicef","components_TableMessageUnicef","Table_Cell","components_FooterUnicef","DETableCell","addUnitMultiplierToUnit","headerObj","uprs","newUprs","mult","customAttributes","idsNotInMany","getTableData","mapProps","chartData","observationGetter","Chart","owner","footer_visible","subtitle","tooltip","axisLegend","chartLegend","footer","copyright","source","branch","renderComponent","message","Footnotes","List_default","dense","ListItem_default","ListItemText_default","Main","enhancedData","isLoadingData","formaterIds","dataUrl","dotstatsuite_components_lib","sdmxUrl","render","properties","loadingLabel","isLarge","Viewer","components_Footnotes","decimals","prefscale","HierarchicalCodelist","onChangeIsOpen","handleNodeExpand","nodeData","isExpanded","expandedNodes","handleNodeCollapse","newExpanded","handleNodeClick","expandNodes","toExpand","childNodes","n","hierarchyName","isCollapsible","tree","contents","onNodeExpand","onNodeCollapse","onNodeClick","createTreeContents","selCodes","codesInCodelist","hi","createTreeNode","hierarchyNode","depth","isSelCode","selCodeParent","selCodeCount","ch","secondaryLabel","App","isLoadingStructure","components_NarrowFilters","components_HierarchicalCodelist","components_Main","_React$Component","_temp","_getPrototypeOf2","_len","args","_key","react","withResponsiveness_Narrow","withResponsiveness_Default","inherits","renderNothing","ES6_Error","info","_ref$locales","locales","_ref$localeId","addLocaleData","enLocaleData","numeral","delimiters","register","initializeI18n","i18n","store","initialState","rootReducer","thunk","enhancers","applyMiddleware","createStore","logs","pending","viewer","TIME_PERIOD","reducer","DATAFLOW","loadHierarchy","ROOT","event","components_Error","es","web_theme","provider","I18N","components_App","module","exports","__webpack_require__","p"],"mappings":"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","file":"static/js/main.454b7a81.chunk.js","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { IntlProvider } from 'react-intl';\r\n\r\nconst Provider = ({ localeId, messages, children }) => (\r\n  <IntlProvider locale={localeId} key={localeId} messages={messages[localeId]}>\r\n    {React.Children.only(children)}\r\n  </IntlProvider>\r\n);\r\n\r\nProvider.propTypes = {\r\n  localeId: PropTypes.string,\r\n  messages: PropTypes.object,\r\n  children: PropTypes.element.isRequired,\r\n};\r\n\r\nexport default Provider;\r\n","import numeral from 'numeral';\r\nimport * as R from 'ramda';\r\nimport { addLocaleData } from 'react-intl';\r\nimport enLocaleData from 'react-intl/locale-data/en';\r\n\r\nconst model = locale => `${locale}/${locale}`;\r\n\r\nexport const setLocale = locale => numeral.locale(model(locale));\r\n\r\nexport const initialize = ({ locales = [], localeId = 'en' }) => {\r\n  addLocaleData(enLocaleData);\r\n\r\n  setLocale(localeId);\r\n\r\n  R.forEach(locale => {\r\n    const delimiters = R.prop('delimiters')(locale);\r\n    if (R.isNil(delimiters)) return;\r\n    numeral.register('locale', model(R.prop('id')(locale)), { delimiters });\r\n  }, R.values(locales));\r\n};\r\n\r\nexport { default as I18nProvider } from './provider';\r\n","import * as R from 'ramda';\r\n\r\n//-----------------------------------------------------------------------------------------constants\r\nexport const LOG_ERROR = '@@app/LOG_ERROR';\r\nexport const PUSH_LOG = '@@app/PUSH_LOG';\r\nexport const SET_PENDING = '@@app/SET_PENDING';\r\n\r\n//------------------------------------------------------------------------------------------creators\r\nexport const pushLog = log => ({ type: PUSH_LOG, payload: { log } });\r\nexport const setPending = (id, is) => ({ type: SET_PENDING, payload: { id, is } });\r\n\r\n//-------------------------------------------------------------------------------------------reducer\r\nexport default (state = {}, action = {}) => {\r\n  switch (action.type) {\r\n    case PUSH_LOG:\r\n      return R.over(R.lensProp('logs'), R.prepend(action.payload.log), state);\r\n    case SET_PENDING:\r\n      return R.assocPath(['pending', action.payload.id], action.payload.is, state);\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import * as R from 'ramda';\r\n\r\nexport const sdmx = R.propOr({}, 'sdmx', window.SETTINGS);\r\nexport const getDatasource = R.flip(R.prop)(R.prop('datasources', sdmx));\r\nexport const sdmxRange = R.prop('range', sdmx);\r\nexport const sdmxPeriod = R.path(['period', 'default'], sdmx);\r\nexport const sdmxPeriodBoundaries = R.pathOr([], ['period', 'boundaries'], sdmx);\r\nexport const sdmxPeriodBoundariesMinMax = {\r\n  min: R.head(sdmxPeriodBoundaries),\r\n  max: R.last(sdmxPeriodBoundaries),\r\n};\r\nexport const getSdmxAttribute = id =>\r\n  R.pipe(R.pathOr([], ['attributes', id]), R.ifElse(R.is(Array), R.identity, R.flip(R.append)([])))(\r\n    sdmx,\r\n  );\r\nexport const chart = R.propOr({}, 'chart', window.SETTINGS);\r\nexport const chartOptions = R.prop('options', chart);\r\n\r\nexport const getIndicatorProfileUrl = R.path(['unicef', 'indicatorProfileUrl'], window.SETTINGS);\r\nexport const getHelpUrl = R.path(['unicef', 'helpUrl'], window.SETTINGS);\r\n","import * as R from 'ramda';\r\nimport md5 from 'md5';\r\n\r\nconst isValidNumber = R.both(R.is(Number), R.complement(R.equals(NaN)));\r\n\r\nexport const getIsSelected = ({ index, id, annotations, selection }) => {\r\n  if (R.or(R.isEmpty(selection), R.isNil(selection))) {\r\n    return R.ifElse(R.isEmpty, R.F, R.pipe(R.find(R.propEq('type', 'DEFAULT')), Boolean))(\r\n      annotations,\r\n    );\r\n  }\r\n  return !!R.prop(md5(`${index}${id}`))(selection);\r\n};\r\n\r\nexport const getSortedCodes = lang =>\r\n  R.sortBy(\r\n    R.pipe(\r\n      R.propOr([], 'annotations'),\r\n      R.find(R.propEq('type', 'ORDER')),\r\n      R.prop('text'),\r\n      R.propOr(0, lang),\r\n      Number,\r\n      R.ifElse(isValidNumber, R.identity, R.always(0)),\r\n    ),\r\n  );\r\n","import * as R from 'ramda';\r\nimport { getIsSelected, getSortedCodes } from './annotations';\r\n\r\nexport default structure => {\r\n  const lang = R.pipe(R.pathOr([], ['meta', 'content-languages']), R.head)(structure);\r\n  const dimensions = R.pipe(\r\n    R.pathOr([], ['data', 'dataStructures']),\r\n    R.head,\r\n    R.pathOr([], ['dataStructureComponents', 'dimensionList', 'dimensions']),\r\n  )(structure);\r\n  const conceptSchemes = R.pathOr([], ['data', 'conceptSchemes'])(structure);\r\n\r\n  if (R.any(R.anyPass([R.isNil, R.isEmpty]))([lang, dimensions, conceptSchemes])) {\r\n    return { dimensions: [], dataflow: {} };\r\n  }\r\n\r\n  const getCodelists = R.pathOr([], ['data', 'codelists']);\r\n  const codelists = getCodelists(structure);\r\n\r\n  const getLocalisedName = id =>\r\n    R.pipe(R.pathOr('', ['name', lang]), R.ifElse(R.isEmpty, R.always(`[${id}]`), R.identity));\r\n\r\n  const getDataflow = R.pipe(\r\n    R.pathOr([], ['data', 'dataflows']),\r\n    R.head,\r\n    R.pick(['id', 'version', 'agencyID', 'name']),\r\n    ({ id, agencyID, ...rest }) => ({\r\n      ...rest,\r\n      code: id,\r\n      agencyId: agencyID,\r\n      name: getLocalisedName(id)(rest),\r\n    }),\r\n  );\r\n  const filters = R.addIndex(R.reduce)(\r\n    (acc, dimension, index) => {\r\n\r\n      console.log(\"in filter\")\r\n      \r\n      console.log(dimension)\r\n      \r\n      const getConceptIdentity = R.propOr(null, 'conceptIdentity');\r\n      if (R.isNil(getConceptIdentity(dimension))) return acc;\r\n      const conceptIdentity = getConceptIdentity(dimension);\r\n\r\n      const getUrnToParse = R.match(/[^urn:sdmx:org.sdmx.infomodel][^.|=]+/g);\r\n      if (R.isEmpty(getUrnToParse(conceptIdentity))) return acc;\r\n      const conceptIdentityUrnToParse = getUrnToParse(conceptIdentity);\r\n      const conceptIdentityRepresentationCode = R.last(conceptIdentityUrnToParse);\r\n\r\n      const getConceptScheme = R.find(({ agencyID, id, version }) => {\r\n        const getSdmxId = R.match(/=(.*\\))/);\r\n        const sdmxId = R.tail(R.head(getSdmxId(conceptIdentity)));\r\n        const sdmxIdRecomposed = `${agencyID}:${id}(${version})`;\r\n        return sdmxIdRecomposed === sdmxId;\r\n      });\r\n      const conceptScheme = getConceptScheme(conceptSchemes);\r\n      const getConcepts = R.propOr(null, 'concepts');\r\n      if (R.isNil(getConcepts(conceptScheme))) return acc;\r\n      const concepts = getConcepts(conceptScheme);\r\n\r\n      const getConcept = R.find(R.propEq('id', conceptIdentityRepresentationCode));\r\n      if (R.isNil(getConcept(concepts))) return acc;\r\n      const concept = getConcept(concepts);\r\n\r\n      const getId = R.propOr(null, 'id');\r\n      if (R.isNil(getId(dimension))) return acc;\r\n      const id = getId(dimension);\r\n\r\n      const getForcedDims=R.propOr(null,\"forced\");\r\n      const forced=getForcedDims(dimension);\r\n\r\n\r\n      // ---------------------------------------------------------------------------------------------\r\n      //                                  values [ ]\r\n      // ---------------------------------------------------------------------------------------------\r\n\r\n      const getLocalRepresentation = R.pathOr(null, ['localRepresentation', 'enumeration']);\r\n      if (R.isNil(getLocalRepresentation(dimension))) return [];\r\n\r\n      const localRepresentation = getLocalRepresentation(dimension);\r\n\r\n      const type = R.nth(1)(getUrnToParse(localRepresentation));\r\n\r\n      const getLink = annotations => {\r\n        if (R.isNil(annotations)) return null;\r\n        for (let i = 0; i < annotations.length; i++) {\r\n          if (annotations[i].type == 'link') {\r\n            return annotations[i].value;\r\n          }\r\n        }\r\n        return null;\r\n      };\r\n\r\n      const getCodeList = R.find(({ agencyID, id, version }) => {\r\n        const getSdmxId = R.match(/=(.*\\))/);\r\n        const sdmxId = R.tail(R.head(getSdmxId(localRepresentation)));\r\n        const sdmxIdRecomposed = `${agencyID}:${id}(${version})`;\r\n        return sdmxIdRecomposed === sdmxId && type === 'Codelist';\r\n      });\r\n\r\n      if (R.isEmpty(codelists) || R.isEmpty(R.propOr([], 'codes')(getCodeList(codelists)))) {\r\n        return acc;\r\n      }\r\n      const codes = getSortedCodes(lang)(R.propOr([], 'codes')(getCodeList(codelists)));\r\n\r\n      const localisedCodes = index =>\r\n        R.map(({ id, parent, name, annotations = [] }) => ({\r\n          id,\r\n          parentId: parent,\r\n          isDefaultSelected: getIsSelected({ index, id, annotations }),\r\n          //isDefaultSelected: id === 'DSB_STATUS_TOTAL' || id === 'SEX_T',\r\n          label: getLocalisedName(id)({ name }),\r\n          link: getLink(annotations),\r\n        }));\r\n\r\n      const parsedDimension = {\r\n        id,\r\n        index,\r\n        roles: !R.isNil(dimension.conceptRoles) ? dimension.conceptRoles : [],\r\n        values: localisedCodes(index)(codes),\r\n        forced\r\n      };\r\n\r\n      return [\r\n        ...acc,\r\n        {\r\n          ...parsedDimension,\r\n          label: getLocalisedName(parsedDimension.id)(concept),\r\n        },\r\n      ];\r\n    },\r\n    [],\r\n    dimensions,\r\n  );\r\n  return { dimensions: filters, dataflow: getDataflow(structure) };\r\n};\r\n","//The lang is requested to the SDMX registr in the GET request.\r\n//The sdmx registry returns a node with the requesnted lang (defaults to en if missing).\r\n//Just get the value of the first returned node\r\nconst getLocalisedName = node => {\r\n  if (!node || node.length == 0) return '';\r\n  return node[0].value;\r\n};\r\n\r\nconst getAnyNode = (node, alt) => {\r\n  if (!node || !alt) return null;\r\n  for (let i = 0; i < alt.length; i++) {\r\n    if (node.hasOwnProperty(alt[i])) return node[alt[i]];\r\n  }\r\n  return null;\r\n};\r\n\r\nconst getDimensions = (ref, dsds) => {\r\n  //\"dataStructureRef\": \"urn:sdmx:org.sdmx.infomodel.datastructure.DataStructure=UNESCO:EDU_NON_FINANCE(3.0)\"\r\n\r\n  //Could use a regex but it seems that Firefox doesn't support lookbehind\r\n  const dsdId = ref.split('=')[1];\r\n  const agency = dsdId.split(':')[0]; //Split and take agency\r\n  const id = dsdId.split(':')[1].split('(')[0]; //Split and take Dataflow\r\n  const v = dsdId\r\n    .split(':')[1]\r\n    .split('(')[1]\r\n    .slice(0, -1); //split and take version\r\n\r\n  //Get the DSD matching the agency, dsd and version\r\n  const dsd = dsds.filter(el => {\r\n    return el.agencyID == agency && el.id == id && el.version == v;\r\n  })[0];\r\n\r\n  const ret = [];\r\n  dsd.dataStructureComponents.dimensionList.dimensions.forEach(el => {\r\n    //the urn is urn:sdmx:org.sdmx.infomodel.datastructure.TimeDimension=UNICEF_TEST:DSD_DHIS_SAMPLE_2(1.0).TIME_PERIOD\r\n    //use the id in this case\r\n    ret.push(el.id);\r\n  });\r\n\r\n  return ret;\r\n};\r\n\r\nconst getDataflow = (df, dsds) => {\r\n  return {\r\n    id: df.id,\r\n    name: df.name,\r\n    agencyID: df.agencyID,\r\n    version: df.version,\r\n    isFinal: df.isFinal,\r\n    dimensions: getDimensions(df.structure, dsds),\r\n  };\r\n};\r\n\r\nexport default dataflowsParser => {\r\n  const ret = {};\r\n  if (!dataflowsParser.data.data.dataflows) return ret;\r\n  dataflowsParser.data.data.dataflows.forEach(element => {\r\n    ret[element.id] = getDataflow(element, dataflowsParser.data.data.dataStructures);\r\n  });\r\n  return ret;\r\n};\r\n","const getReferencedCodeLabel = (code, refCodelist) => {\r\n  for (let i = 0; i < refCodelist[code.codelistAliasRef].length; i++) {\r\n    if (refCodelist[code.codelistAliasRef][i].id == code.codeID) {\r\n      return refCodelist[code.codelistAliasRef][i].name;\r\n    }\r\n  }\r\n};\r\n\r\nconst getCodesHierarchy = (codes, refCodelist) => {\r\n  const ret = [];\r\n  codes.forEach(c => {\r\n    let code = {\r\n      id: c.id,\r\n      codeID: c.codeID,\r\n      name: getReferencedCodeLabel(c, refCodelist),\r\n    };\r\n\r\n    if (c.hierarchicalCodes) {\r\n      code.codes = getCodesHierarchy(c.hierarchicalCodes, refCodelist);\r\n    }\r\n    ret.push(code);\r\n  });\r\n\r\n  return ret;\r\n};\r\n\r\nconst getHierarchy = (hierarchy, refCodelist) => {\r\n  const ret = {\r\n    name: hierarchy.name,\r\n    hierarchies: [],\r\n  };\r\n\r\n  hierarchy.hierarchies.forEach(h => {\r\n    let node = {\r\n      id: h.id,\r\n      codeID: h.codeID,\r\n      name: h.name,\r\n      codes: getCodesHierarchy(h.hierarchicalCodes, refCodelist),\r\n    };\r\n    ret.hierarchies.push(node);\r\n  });\r\n  return ret;\r\n};\r\n\r\nconst urnToStructureId = urn => {\r\n  const structureID = urn.split('=')[1];\r\n  const ag = structureID.split(':')[0];\r\n  const id = structureID.split(':')[1].split('(')[0];\r\n  const ver = structureID\r\n    .split(':')[1]\r\n    .split('(')[1]\r\n    .split(')')[0];\r\n\r\n  return {\r\n    agencyID: ag,\r\n    id: id,\r\n    version: ver,\r\n  };\r\n};\r\n\r\nexport default hierarchyParser => {\r\n  const ret = {};\r\n  if (!hierarchyParser.data.hierarchicalCodelists) return ret;\r\n  if (hierarchyParser.data.hierarchicalCodelists.length == 0) return ret;\r\n\r\n  const refCodelists = {};\r\n  const includedCL = hierarchyParser.data.hierarchicalCodelists[0].includedCodelists;\r\n  for (var k in includedCL) {\r\n    if (includedCL.hasOwnProperty(k)) {\r\n      const strId = urnToStructureId(includedCL[k]);\r\n      hierarchyParser.data.codelists.forEach(cl => {\r\n        if (cl.agencyID == strId.agencyID && cl.id == strId.id && cl.version == strId.version) {\r\n          refCodelists[k] = cl.codes;\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  return getHierarchy(hierarchyParser.data.hierarchicalCodelists[0], refCodelists);\r\n};\r\n","import * as R from 'ramda';\r\nimport qs from 'qs';\r\nimport { getDatasource } from '../settings';\r\nimport { rules } from '@sis-cc/dotstatsuite-components';\r\nexport { default as structureParser } from './structure';\r\nexport { default as dataflowsParser } from './dataflows';\r\nexport { default as hierarchyParser } from './hierarchy';\r\n\r\nexport const getDataflowsConfig = ({ configArgs }) => {\r\n  const { datasourceId } = R.prop('dataflow', configArgs);\r\n  const datasource = getDatasource(datasourceId);\r\n\r\n  return {\r\n    url: `${R.prop('url', datasource)}/dataflow/all/all/latest/`,\r\n    datasource,\r\n  };\r\n};\r\n\r\nexport const getHierarchyUrl = ({ configArgs }) => {\r\n  const { datasourceId } = R.prop('dataflow', configArgs);\r\n  const datasource = getDatasource(datasourceId);\r\n\r\n  let ag = configArgs.config.hierarchy.agencyId;\r\n  let id = configArgs.config.hierarchy.id;\r\n\r\n  return `${R.prop('url', datasource)}/hierarchicalcodelist/${ag}/${id}/latest/`;\r\n};\r\n\r\nexport const getFusionConfig = ({ configArgs }) => {\r\n  const { datasourceId, dataflowId, agencyId, version } = R.prop('dataflow', configArgs);\r\n\r\n  const datasource = getDatasource(datasourceId);\r\n  if (R.isNil(datasource)) throw new Error(`Datasource undefined: datasourceId=${datasourceId}`);\r\n\r\n  const identifiers = R.join(',', [agencyId, dataflowId, R.defaultTo('latest', version)]);\r\n  return {\r\n    url: `${R.prop('url', datasource)}/availableconstraint/${identifiers}`,\r\n    datasource,\r\n  };\r\n\r\n  /*return {\r\n    url: `${R.prop('url', datasource)}/dataflow/${identifiers}`,\r\n    datasource,\r\n  };*/\r\n};\r\n\r\nexport const getConfig = ({ type }) => ({ configArgs }) => {\r\n  if (R.not(R.includes(type, ['structure', 'data']))) throw new Error(`Invalid type: type=${type}`);\r\n\r\n  const { datasourceId, dataflowId, agencyId, version } = R.prop('dataflow', configArgs);\r\n\r\n  const datasource = getDatasource(datasourceId);\r\n  if (R.isNil(datasource)) throw new Error(`Datasource undefined: datasourceId=${datasourceId}`);\r\n\r\n  const isStructure = R.equals(type, 'structure');\r\n\r\n  const keyword = isStructure ? 'dataflow' : 'data';\r\n\r\n  const identifiers = R.join(isStructure ? '/' : ',', [\r\n    agencyId,\r\n    dataflowId,\r\n    R.defaultTo('latest', version),\r\n  ]);\r\n\r\n  const dataquery = isStructure ? '' : `/${R.defaultTo('all', R.prop('dataquery', configArgs))}`;\r\n\r\n  return {\r\n    url: `${R.prop('url', datasource)}/${keyword}/${identifiers}${dataquery}`,\r\n    datasource,\r\n  };\r\n};\r\n\r\nexport const getDataUrl = ({ configArgs, requestArgs }) => {\r\n  const period = R.prop('period', requestArgs);\r\n  const url = R.prop('url', getConfig({ type: 'data' })({ configArgs }));\r\n  const params = qs.stringify(\r\n    { startPeriod: R.head(period), endPeriod: R.last(period) },\r\n    { addQueryPrefix: true },\r\n  );\r\n\r\n  return `${url}${params}`;\r\n};\r\n\r\nexport const getFilename = R.pipe(\r\n  R.converge(R.append, [\r\n    R.pipe(R.prop('dataquery'), R.ifElse(R.isNil, R.always('all'), R.identity)),\r\n    R.pipe(\r\n      R.prop('dataflow'),\r\n      R.pick(['datasourceId', 'dataflowId', 'agencyId', 'version']),\r\n      R.values,\r\n    ),\r\n  ]),\r\n  R.join('_'),\r\n);\r\n\r\nexport const updateDataquery = dimensions => (filterId, valueId) => dataquery => {\r\n\r\n  // console.log(\"updateDataquery\")\r\n  // console.log(dimensions)\r\n  // console.log(filterId)\r\n  // console.log(valueId)\r\n  // console.log(dataquery)\r\n  // undefined filterId <=> no selection\r\n  if (R.isNil(filterId)) return R.reduce(R.concat('.'), '', dimensions);\r\n\r\n  const filterIndex = R.findIndex(R.propEq('id', filterId), dimensions);\r\n\r\n  // console.log(\"dimensions[filterIndex]\")\r\n  // console.log(dimensions[filterIndex])\r\n\r\n  if (dimensions[filterIndex].forced!=null){\r\n    valueId=dimensions[filterIndex].forced;\r\n  }\r\n\r\n  const safeDataquery = R.isNil(dataquery) ? R.reduce(R.concat('.'), '', dimensions) : dataquery;\r\n\r\n  // undefined valueId <=> remove filter from selection\r\n  if (R.isNil(valueId)) {\r\n    return R.pipe(R.split('.'), R.update(filterIndex, ''), R.join('.'))(safeDataquery);\r\n  }\r\n\r\n  return R.pipe(\r\n    R.split('.'),\r\n    R.over(\r\n      R.lensIndex(filterIndex),\r\n      R.pipe(\r\n        R.ifElse(R.isEmpty, R.always([]), R.split('+')),\r\n        R.ifElse(R.includes(valueId), R.without([valueId]), R.append(valueId)),\r\n        R.join('+'),\r\n      ),\r\n    ),\r\n    R.join('.'),\r\n  )(safeDataquery);\r\n};\r\n\r\nconst greaterThanOne = R.pipe(R.length, R.flip(R.gt)(1));\r\nconst isMany = d =>\r\n  R.or(rules.isTimeDimension(R.prop('id')(d)), greaterThanOne(R.prop('values')(d)));\r\nexport const getDimensionsIds = R.pipe(R.filter(isMany), R.map(R.prop('id')));\r\nexport const getUniq = (array1, array2) => R.pipe(R.concat(array2), R.uniq)(array1);\r\n","import React from 'react';\r\nimport * as R from 'ramda';\r\nimport { rules } from '@sis-cc/dotstatsuite-components';\r\nimport numeral from 'numeral';\r\nimport { DETableCell } from '@sis-cc/dotstatsuite-ui-components';\r\n\r\nexport const renameKeys = R.curry((keysMap, obj) =>\r\n  R.reduce((acc, key) => R.assoc(keysMap[key] || key, obj[key], acc), {}, R.keys(obj)),\r\n);\r\n\r\nexport const isValidNumber = R.both(R.is(Number), R.complement(R.equals(NaN)));\r\nexport const withIndex = R.addIndex(R.map)((value, index) => R.assoc('index', index)(value));\r\n\r\nexport const observationGetter = ({\r\n  observations,\r\n  dimensions,\r\n  customAttributes,\r\n  isRtl,\r\n}) => () => coordinates => {\r\n  const isUncoded = R.anyPass([\r\n    R.prop('isFootnote'),\r\n    () => R.equals(R.prop('name'), R.prop('id')),\r\n    R.pipe(R.prop('id'), R.length, R.lte(4)),\r\n  ]);\r\n\r\n  const cellProps = isRtl => (value, valueFlags) => {\r\n    const [uncodedFlags, codedFlags] = R.partition(isUncoded)(valueFlags);\r\n    return { isRtl, value, codedFlags, uncodedFlags };\r\n  };\r\n\r\n  const getValueId = valueIndexes =>\r\n    R.pipe(\r\n      R.converge(R.prop, [R.pipe(R.prop('index'), R.nth(R.__, valueIndexes)), R.prop('values')]),\r\n      R.prop('id'),\r\n    );\r\n\r\n  const formatDecimal = ({ customAttributes, valueIndexes }) => {\r\n    const attr = R.prop('decimals', customAttributes);\r\n\r\n    if (R.isNil(attr)) return R.identity;\r\n\r\n    const d = Number(getValueId(valueIndexes)(attr));\r\n    if (R.complement(isValidNumber)(d)) return R.identity;\r\n    const format = R.equals(d, 0) ? '0' : `0,0.[${R.join('', R.times(R.always('0'), d))}]`;\r\n\r\n    return value => numeral(value).format(format);\r\n  };\r\n\r\n  const formatScale = ({ customAttributes, valueIndexes }) => {\r\n    const attr = R.prop('prefscale', customAttributes);\r\n    if (R.isNil(attr)) return R.identity;\r\n\r\n    const e = Number(getValueId(valueIndexes)(attr));\r\n    if (R.complement(isValidNumber)(e)) return R.identity;\r\n\r\n    return value => numeral(value).multiply(Math.pow(10, -1 * e));\r\n  };\r\n\r\n  const formatSeparator = value => {\r\n    if (isValidNumber(value)) return numeral(value).format(`0,0.[0000000]`);\r\n    return R.identity(value);\r\n  };\r\n\r\n  const getValue = customAttributes => values => {\r\n    const valueIndexes = R.tail(values);\r\n\r\n    return R.ifElse(\r\n      isValidNumber,\r\n      R.pipe(\r\n        formatScale({ customAttributes, valueIndexes }),\r\n        formatDecimal({ customAttributes, valueIndexes }),\r\n        formatSeparator,\r\n      ),\r\n      R.always('-'),\r\n    )(R.nth(0)(values));\r\n  };\r\n\r\n  const getValueFlags = attributeFlags =>\r\n    R.addIndex(R.reduce)((acc, valueIndex, attributeIndex) => {\r\n      if (R.isNil(valueIndex)) return acc;\r\n      const flag = R.prop(attributeIndex)(attributeFlags);\r\n      if (R.isNil(flag)) return acc;\r\n      return R.append(\r\n        R.pipe(\r\n          R.prop('values'),\r\n          R.nth(valueIndex),\r\n          R.assoc('isFootnote')(R.prop('isFootnote')(flag)),\r\n        )(flag),\r\n      )(acc);\r\n    }, []);\r\n\r\n  const observation = R.pipe(\r\n    R.toPairs,\r\n    R.sortBy(\r\n      R.pipe(R.prop(0), R.flip(R.prop)({ ...dimensions.many, ...dimensions.one }), R.prop('index')),\r\n    ),\r\n    R.pluck(1),\r\n    R.join(':'),\r\n    R.flip(R.propOr([]))(observations),\r\n    R.converge(cellProps(isRtl), [\r\n      getValue(customAttributes),\r\n      R.pipe(R.tail, getValueFlags(R.prop('flags')(customAttributes))),\r\n    ]),\r\n  )({\r\n    ...coordinates,\r\n    ...R.reduce((memo, { id }) => ({ ...memo, [id]: 0 }), {})(R.values(dimensions.one)),\r\n  });\r\n\r\n  return <DETableCell {...observation} />;\r\n};\r\n\r\nexport const observationFormat = ({ isRtl }) => ({ observations, dimensions, customAttributes }) =>\r\n  observationGetter({\r\n    dimensions,\r\n    observations,\r\n    customAttributes,\r\n    isRtl,\r\n  })(R.identity);\r\n\r\nexport const dimensionFormats = {\r\n  label: rules.dimensionValueDisplay('label'),\r\n  code: rules.dimensionValueDisplay('code'),\r\n  both: rules.dimensionValueDisplay('both'),\r\n};\r\n\r\nexport const getDimensionGetters = intl =>\r\n  R.reduce(\r\n    (memo, key) => ({\r\n      ...memo,\r\n      [key]: intl.formatMessage({ id: `vx.config.display.${key}` }),\r\n    }),\r\n    {},\r\n    R.keys(dimensionFormats),\r\n  );\r\n\r\nexport const makeTree = items => {\r\n  const hierarchy = R.reduce(\r\n    (index, item) =>\r\n      item.parent in index\r\n        ? R.assoc(item.id, [], R.assoc(item.parent, R.append(item.id, index[item.parent]), index))\r\n        : R.assoc(item.id, [], index),\r\n    {},\r\n    items,\r\n  ); //=> E.g. {\"1\":[2],\"2\":[3],\"3\":[],\"4\":[]}\r\n  const index = R.map(R.head, R.groupBy(R.prop('id'), items)); //=> E.g. {\"!\": <item1>, \"2\": <item2>, ...}\r\n  const assoc = id => {\r\n    const childNodes = id => R.map(makeNode, hierarchy[id]);\r\n    return R.isEmpty(childNodes(id)) ? index[id] : R.assoc('childNodes', childNodes(id), index[id]);\r\n  };\r\n  const makeNode = id => R.dissoc('parent', assoc(id));\r\n  return R.map(makeNode, R.pluck('id', R.filter(item => R.isNil(item.parent), items)));\r\n};\r\n\r\nexport const computeHasSpotlight = values => {\r\n  const LIMIT = 8;\r\n  if (R.gt(R.length(values), LIMIT)) return true;\r\n\r\n  const computeflatArray = (acc, item) => {\r\n    if (item.childNodes) return R.reduce(computeflatArray, acc, item.childNodes);\r\n    return [...acc, item.id];\r\n  };\r\n\r\n  return R.gt(R.length(R.reduce(computeflatArray, [], values)), LIMIT);\r\n};\r\n","import { createSelector } from 'reselect';\r\nimport * as R from 'ramda';\r\nimport { sdmxPeriod } from '../lib/settings';\r\nimport { dimensionFormats } from '../lib/utils';\r\n\r\n//------------------------------------------------------------------------------------------------#0\r\nconst getVis = R.prop('vis');\r\n\r\n//------------------------------------------------------------------------------------------------#1\r\nexport const getPeriod = createSelector(\r\n  getVis,\r\n  R.pipe(\r\n    R.prop('period'),\r\n    R.ifElse(R.pipe(R.length, R.equals(2)), R.identity, R.always(sdmxPeriod)),\r\n  ),\r\n);\r\n\r\nexport const getLastnobservations = createSelector(getVis, R.prop('lastnobservations'));\r\n\r\nexport const getViewer = createSelector(getVis, R.prop('viewer'));\r\n\r\nexport const getAction = createSelector(getVis, R.prop('action'));\r\n\r\nexport const getDisplay = createSelector(getVis, R.prop('display'));\r\n\r\nexport const getFilter = createSelector(getVis, R.prop('filter'));\r\n\r\nexport const getDataflow = createSelector(getVis, R.prop('dataflow'));\r\n\r\nexport const getDataquery = createSelector(getVis, R.prop('dataquery'));\r\n\r\nexport const getIsFullscreen = createSelector(getVis, R.prop('isFullscreen'));\r\n\r\nexport const getTimeDimensionInverted = createSelector(getVis, R.prop('timeDimensionInverted'));\r\n\r\nexport const getLayout = createSelector(getVis, R.prop('layout'));\r\n\r\nexport const getDimensionGetter = createSelector(getVis, R.prop('dimensionGetter'));\r\n\r\nexport const getDimensionFormat = createSelector(\r\n  getDimensionGetter,\r\n  R.flip(R.prop)(dimensionFormats),\r\n);\r\n","import { createSelector } from 'reselect';\r\nimport * as R from 'ramda';\r\nimport Set from 'es6-set';\r\nimport { getDataquery as getVisDataquery, getDimensionFormat } from './vis';\r\nimport { getSdmxAttribute } from '../lib/settings';\r\n\r\n//------------------------------------------------------------------------------------------------#0\r\nconst getSdmx = R.prop('sdmx');\r\n\r\n//------------------------------------------------------------------------------------------------#1\r\nexport const getDimensions = createSelector(getSdmx, R.prop('dimensions'));\r\n\r\nexport const getData = createSelector(getSdmx, R.prop('data'));\r\n\r\nexport const getLayout = createSelector(getSdmx, R.prop('layout'));\r\n\r\nexport const getDataflows = createSelector(getSdmx, R.prop('dataflows'));\r\n\r\n//------------------------------------------------------------------------------------------------#2\r\nexport const getDataquery = createSelector(\r\n  getVisDataquery,\r\n  getDimensions,\r\n  (dataquery, dimensions) => {\r\n    // dataquery in state is priority 1\r\n    if (R.not(R.anyPass([R.isEmpty, R.isNil])(dataquery))) return dataquery;\r\n\r\n    // dataquery extracted from dimensions default selection is priority 2\r\n    return R.pipe(\r\n      R.map(\r\n        R.pipe(\r\n          R.prop('values'),\r\n          R.filter(R.propEq('isDefaultSelected', true)),\r\n          R.pluck('id'),\r\n          R.join('+'),\r\n        ),\r\n      ),\r\n      R.join('.'),\r\n    )(dimensions);\r\n  },\r\n);\r\n\r\nexport const getCustomAttributes = createSelector(getData, getDimensionFormat, (data, format) => {\r\n  const flagsSet = new Set(getSdmxAttribute('flags'));\r\n  const attrs = R.pathOr([], ['structure', 'attributes', 'observation'])(data);\r\n  const isFootnote = true;\r\n\r\n  const customAttrs = R.addIndex(R.reduce)(\r\n    (memo, { id, name, values, ...rattr }, index) => {\r\n      const attr = { ...rattr, id, values, index, isFootnote, label: format({ id, name }) };\r\n\r\n      // flags defined in SETTINGS are *forced* footnotes\r\n      // footnote is annotation...\r\n      if (flagsSet.has(id)) return R.set(R.lensPath(['flags', index]), attr, memo);\r\n\r\n      // decimals is used to format the obs value\r\n      // should not be considered as a footnote\r\n      if (R.includes(id, getSdmxAttribute('decimals'))) return R.assoc('decimals', attr, memo);\r\n\r\n      // real footnotes handling: if single valued then footnote\r\n      if (R.pipe(R.length, R.equals(1))(values))\r\n        return R.over(R.lensProp('footnotes'), R.append(attr), memo);\r\n\r\n      // if multi valued then flag\r\n      if (R.pipe(R.isEmpty, R.not)(values)) return R.set(R.lensPath(['flags', index]), attr, memo);\r\n\r\n      return memo;\r\n    },\r\n    { flags: {} /* , decimals: undefined */, footnotes: [] },\r\n  )(attrs);\r\n\r\n  return customAttrs;\r\n});\r\n\r\n//------------------------------------------------------------------------------------------------#3\r\nexport const getFilters = createSelector(\r\n  getDimensions,\r\n  getDataquery,\r\n  R.pipe(\r\n    R.useWith(\r\n      (filters, dataquery) =>\r\n        R.addIndex(R.map)((filter, index) => {\r\n          \r\n          //A filter has been forced for this dimension, just not return it.\r\n          if (filter.forced)\r\n            return null;\r\n\r\n          if (R.pipe(R.nth(index), R.isEmpty)(dataquery)) return filter;\r\n          if (R.pipe(R.nth(index), R.isNil)(dataquery)) return filter;\r\n\r\n          const valueIdsSet = new Set(R.pipe(R.nth(index), R.split('+'))(dataquery));\r\n\r\n          return R.over(\r\n            R.lensProp('values'),\r\n            R.map(\r\n              R.ifElse(({ id }) => valueIdsSet.has(id), R.assoc('isSelected', true), R.identity),\r\n            ),\r\n            filter,\r\n          );\r\n        }, filters),\r\n      [R.identity, R.split('.')],\r\n    ),\r\n    R.filter(R.pipe(R.prop('values'), R.length, R.lt(1))),\r\n  ),\r\n);\r\n\r\n//------------------------------------------------------------------------------------------------#4\r\nexport const getSelection = createSelector(\r\n  getFilters,\r\n  R.pipe(\r\n    R.map(R.over(R.lensProp('values'), R.filter(R.propEq('isSelected', true)))),\r\n    R.filter(R.pipe(R.prop('values'), R.length, R.flip(R.gt)(0))),\r\n  ),\r\n);\r\n","import * as R from 'ramda';\r\nimport { updateDataquery } from '../lib/sdmx';\r\nimport { getDimensions } from '../selectors/sdmx';\r\n\r\n//-----------------------------------------------------------------------------------------constants\r\nexport const CHANGE_PERIOD = '@@vis/sdmx/CHANGE_PERIOD';\r\nexport const CHANGE_LASTNOBS = '@@vis/sdmx/CHANGE_LASTNOBS';\r\nexport const CHANGE_FILTER = '@@vis/CHANGE_FILTER';\r\nexport const CHANGE_VIEWER = '@@vis/CHANGE_VIEWER';\r\nexport const CHANGE_ACTION = '@@vis/CHANGE_ACTION';\r\nexport const CHANGE_DATAFLOW = '@@vis/sdmx/CHANGE_DATAFLOW';\r\nexport const CHANGE_DATAQUERY = '@@vis/sdmx/CHANGE_DATAQUERY';\r\nexport const OVERRIDE_DATAQUERY = '@@vis/sdmx/OVERRIDE_DATAQUERY';\r\nexport const CHANGE_LAYOUT = '@@vis/CHANGE_LAYOUT';\r\nexport const CHANGE_DIMENSION_GETTER = '@@vis/CHANGE_DIMENSION_GETTER';\r\nexport const CHANGE_IS_TIME_DIMENSION_INVERTED = '@@vis/CHANGE_IS_TIME_DIMENSION_INVERTED';\r\nexport const LOAD_DATAFLOWS = '@@vis/sdmx/LOAD_DATAFLOWS';\r\nexport const LOAD_HIERARCHY = '@@vis/sdmx/LOAD_HIERARCHY';\r\n\r\n//------------------------------------------------------------------------------------------creators\r\nexport const changeLastnobs = lastnobservations => ({\r\n  type: CHANGE_LASTNOBS,\r\n  payload: { lastnobservations },\r\n});\r\nexport const changePeriod = period => ({ type: CHANGE_PERIOD, payload: { period } });\r\nexport const changeFilter = filterId => ({ type: CHANGE_FILTER, payload: { filterId } });\r\nexport const changeViewer = viewerId => ({ type: CHANGE_VIEWER, payload: { viewerId } });\r\nexport const changeAction = actionId => ({ type: CHANGE_ACTION, payload: { actionId } });\r\nexport const changeDataflow = dataflow => ({ type: CHANGE_DATAFLOW, payload: { dataflow } });\r\nexport const changeLayout = layout => ({ type: CHANGE_LAYOUT, payload: { layout } });\r\nexport const changeDimensionGetter = dimensionGetter => ({\r\n  type: CHANGE_DIMENSION_GETTER,\r\n  payload: { dimensionGetter },\r\n});\r\nexport const changeIsTimeDimensionInverted = (id, isTimeDimensionInverted) => ({\r\n  type: CHANGE_IS_TIME_DIMENSION_INVERTED,\r\n  payload: { id, isTimeDimensionInverted },\r\n});\r\nexport const changeDataquery = (filterId, valueId) => (dispatch, getState) =>\r\n  dispatch({\r\n    type: CHANGE_DATAQUERY,\r\n    payload: { filterId, valueId, dimensions: getDimensions(getState()) },\r\n  });\r\n\r\nexport const loadDataflows = () => ({ type: LOAD_DATAFLOWS, payload: {} });\r\nexport const loadHierarchy = (config, dataflow) => ({\r\n  type: LOAD_HIERARCHY,\r\n  payload: { config: config, dataflow: dataflow },\r\n});\r\nexport const changeDq = (filterId, valueId, dims) => ({\r\n  type: CHANGE_DATAQUERY,\r\n  payload: { filterId, valueId, dimensions: dims },\r\n});\r\n\r\n//-------------------------------------------------------------------------------------------reducer\r\nexport default (state = {}, action = {}) => {\r\n  switch (action.type) {\r\n    case CHANGE_ACTION:\r\n      var isFullscreen = R.always(R.equals(action.payload.actionId, 'fullscreen'));\r\n      return R.evolve({\r\n        isFullscreen: R.ifElse(isFullscreen, R.not, R.identity),\r\n        action: R.cond([\r\n          [isFullscreen, R.identity],\r\n          [R.equals(action.payload.actionId), R.always(undefined)],\r\n          [R.T, R.always(action.payload.actionId)],\r\n        ]),\r\n      })(state);\r\n    case CHANGE_FILTER:\r\n      return R.over(\r\n        R.lensProp('filter'),\r\n        filter =>\r\n          R.ifElse(R.equals(filter), R.always(undefined), R.identity)(\r\n            R.path(['payload', 'filterId'], action),\r\n          ),\r\n        state,\r\n      );\r\n    case CHANGE_PERIOD:\r\n      return R.set(R.lensProp('period'), R.path(['payload', 'period'], action), state);\r\n    case CHANGE_LASTNOBS:\r\n      return R.set(\r\n        R.lensProp('lastnobservations'),\r\n        R.path(['payload', 'lastnobservations'], action),\r\n        state,\r\n      );\r\n    case CHANGE_VIEWER:\r\n      return R.set(R.lensProp('viewer'), R.path(['payload', 'viewerId'], action), state);\r\n    case CHANGE_LAYOUT:\r\n      return R.set(R.lensProp('layout'), R.path(['payload', 'layout'], action), state);\r\n    case CHANGE_DIMENSION_GETTER:\r\n      return R.set(\r\n        R.lensProp('dimensionGetter'),\r\n        R.path(['payload', 'dimensionGetter'], action),\r\n        state,\r\n      );\r\n    case CHANGE_IS_TIME_DIMENSION_INVERTED:\r\n      return {\r\n        ...state,\r\n        timeDimensionInverted: R.set(\r\n          R.lensProp(action.payload.id),\r\n          !action.payload.isTimeDimensionInverted,\r\n          state.timeDimensionInverted,\r\n        ),\r\n      };\r\n    case CHANGE_DATAQUERY:\r\n      return R.over(\r\n        R.lensProp('dataquery'),\r\n        updateDataquery(R.path(['payload', 'dimensions'], action))(\r\n          R.path(['payload', 'filterId'], action),\r\n          R.path(['payload', 'valueId'], action),\r\n        ),\r\n        state,\r\n      );\r\n    case OVERRIDE_DATAQUERY:\r\n      return R.set(R.lensProp('dataquery'), R.prop('dataquery', action), state);\r\n    case CHANGE_DATAFLOW:\r\n      return R.pipe(\r\n        R.set(R.lensProp('viewer'), 'table'),\r\n        R.set(R.lensProp('dataquery'), R.path(['payload', 'dataflow', 'dataquery'], action)),\r\n        R.set(R.lensProp('period'), R.path(['payload', 'dataflow', 'period'], action)),\r\n        R.flip(R.merge)(R.prop('payload', action)),\r\n      )(state);\r\n\r\n    case LOAD_DATAFLOWS:\r\n      return state;\r\n    case LOAD_HIERARCHY:\r\n      return state;\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import { createSelector } from 'reselect';\r\nimport * as R from 'ramda';\r\n\r\n//------------------------------------------------------------------------------------------------#0\r\nconst getApp = R.prop('app');\r\n\r\n//------------------------------------------------------------------------------------------------#1\r\nexport const getLocale = createSelector(getApp, R.prop('locale'));\r\n\r\nexport const getPending = createSelector(getApp, R.prop('pending'));\r\n\r\n//------------------------------------------------------------------------------------------------#2\r\nexport const getIsPending = id => createSelector(getPending, R.pipe(R.prop(id), R.equals(true)));\r\n\r\nexport const getIsRtl = createSelector(getLocale, R.propEq('isRtl', true));\r\n","'use strict';\r\nimport { getIndicatorProfileUrl } from '../lib/settings';\r\n\r\nconst parentInCodelist = (codes, codeId) => {\r\n  if (!codes) return false;\r\n  codes.forEach(c => {\r\n    console.log(c.id + ' ' + codeId);\r\n    if (c.id == codeId) {\r\n      console.log('found');\r\n      return true;\r\n    }\r\n  });\r\n  console.log('Missing');\r\n  return false;\r\n};\r\n\r\nexport const mapStructure = (s, lang) => {\r\n  console.log(\"mapStructure\")\r\n  console.log(s)\r\n\r\n  renameKey(s.meta, 'contentLanguages', 'content-languages');\r\n  //ConceptSchemes\r\n  s.data.conceptSchemes[0].concepts.forEach(c => {\r\n    c.links.forEach(l => {\r\n      l['type'] = 'conceptScheme';\r\n    });\r\n    c.name = c.names;\r\n  });\r\n  //renameKey(s.data, 'conceptschemes', 'conceptSchemes');\r\n\r\n  //codelists\r\n  s.data.codelists.forEach(cl => {\r\n    cl.name = cl.names;\r\n    const parents = new Set();\r\n\r\n    cl.codes.forEach(c => {\r\n      c.name = c.names;\r\n      addLinkAnnotation(cl.id, c);\r\n      if (c.parent) parents.add(c.parent);\r\n    });\r\n\r\n    if (parents.size == 1) {\r\n      cl.codes.forEach(c => {\r\n        if (c.parent) delete c.parent;\r\n      });\r\n    }\r\n  });\r\n\r\n  //datastructures\r\n  //renameKey(s.data, 'datastructures', 'dataStructures');\r\n\r\n  // s.data.dataStructures[0].dataStructureComponents.dimensionList.dimensions.splice(0,1);\r\n\r\n  //dataflows\r\n  s.data.dataflows[0].name = s.data.dataflows[0].names;\r\n\r\n  return s;\r\n};\r\n\r\nconst addLinkAnnotation = (cl_id, code) => {\r\n  if (cl_id != 'CL_UNICEF_INDICATOR') return;\r\n  if (!getIndicatorProfileUrl || getIndicatorProfileUrl == '') return;\r\n  if (typeof code.annotations == 'undefined') code.annotations = [];\r\n  code.annotations.push({ type: 'link', value: getIndicatorProfileUrl + '/' + code.id });\r\n};\r\n\r\nconst renameKey = (object, oldKey, newKey) => {\r\n  if (!object[oldKey]) return;\r\n  object[newKey] = object[oldKey];\r\n  delete object[oldKey];\r\n};\r\n\r\n/*\r\nDATA\r\n*/\r\nexport const convertName2 = (name, lang) => {\r\n  const ret = {};\r\n  ret[lang] = name;\r\n  return ret;\r\n};\r\n\r\nexport const map_struct_component = (comp, lang) => {\r\n  if (comp) {\r\n    comp.forEach(c => {\r\n      c.name = convertName2(c.name, lang);\r\n      c.values.forEach(v => {\r\n        v.name = convertName2(v.name, lang);\r\n      });\r\n    });\r\n  }\r\n};\r\n\r\nexport const mapData = (d, lang) => {\r\n  //console.log(\"MAPPING DATA\")\r\n  //console.log(d)\r\n\r\n  d.meta['content-languages'] = [lang];\r\n\r\n  d.data.structure.name = d.data.structure.names;\r\n\r\n  map_struct_component(d.data.structure.dimensions.dataset, lang);\r\n  map_struct_component(d.data.structure.dimensions.series, lang);\r\n  map_struct_component(d.data.structure.dimensions.observation, lang);\r\n  map_struct_component(d.data.structure.attributes.dataset, lang);\r\n  map_struct_component(d.data.structure.attributes.series, lang);\r\n  map_struct_component(d.data.structure.attributes.observation, lang);\r\n\r\n  //console.log(\"RETURNING\")\r\n  //console.log(ret)\r\n\r\n  return d;\r\n};\r\n","import { getCuratedData } from '@sis-cc/dotstatsuite-ui-components/build/components/de-table/lib/curator';\r\nimport { getSortedLayout } from '@sis-cc/dotstatsuite-ui-components/build/components/de-table/lib/tanker';\r\n\r\nconst TIME_PERIOD_ID = 'TIME_PERIOD';\r\n\r\nconst getDimensionById = (dims, id) => {\r\n  for (var i = 0; i < dims.length; i++) {\r\n    if (dims[i].id == id) {\r\n      return dims[i];\r\n    }\r\n  }\r\n  return null;\r\n};\r\n\r\nconst updateIndex = (index, dimval) => {\r\n  index[dimval.dimension.__index] = dimval.value.__index;\r\n};\r\n\r\nconst idxToString = idx => {\r\n  return idx\r\n    .filter(e => {\r\n      return e != null;\r\n    })\r\n    .join(':');\r\n};\r\n\r\nconst createDataRow = (header, section, datarow, curated, obs, attribs) => {\r\n  const hidx = [];\r\n  const secidx = [];\r\n  const valIdx = [];\r\n  var rowDimVals = [];\r\n  var row = [];\r\n  var dataStartIdx = 0;\r\n  var rowAttribs = [];\r\n\r\n  //Adds the dimension values at the beginning of the data row (when something has benn put on the rows)\r\n  //It is the first level in the \"curated\" structure\r\n  datarow.forEach(dr => {\r\n    rowDimVals.push(dr.value.name);\r\n  });\r\n\r\n  //For each header start to build the observation key:[headerKey1:headerKey2...] => [0:2]\r\n  header.forEach(h => {\r\n    if (h.length > 0) {\r\n      h.forEach(h2 => {\r\n        updateIndex(hidx, h2);\r\n      });\r\n    }\r\n    var headerIndex = idxToString(hidx);\r\n\r\n    //To the same for the section: [sectionKey1:sectionKey2....]\r\n    //It is the second level in the \"curated\" structure\r\n    section.forEach(sec => {\r\n      updateIndex(secidx, sec);\r\n    });\r\n    const sectionIndex = idxToString(secidx);\r\n\r\n    //Same for the row\r\n    //It is the third level in the \"curated\" structure\r\n    datarow.forEach(dr => {\r\n      updateIndex(valIdx, dr);\r\n    });\r\n    const valIndex = idxToString(valIdx);\r\n\r\n    //If header has no index then the key is \"\"\r\n    var lev1 = null;\r\n    if (!headerIndex) {\r\n      lev1 = curated[''];\r\n    } else {\r\n      lev1 = curated[headerIndex];\r\n    }\r\n\r\n    dataStartIdx = row.length;\r\n\r\n    const lev2 = lev1[sectionIndex];\r\n    //Lev 2 is missing? Add a -\r\n    if (!lev2) {\r\n      row.push('-');\r\n      rowAttribs.push('');\r\n      //There is a lev 2 go to lev 3 in the structure\r\n    } else {\r\n      const lev3 = lev2[valIndex];\r\n      //No lev 3 add -\r\n      if (!lev3) {\r\n        row.push('-');\r\n        rowAttribs.push('');\r\n      } else {\r\n        //obs_val\r\n        row.push(obs[lev3][0]);\r\n        //attribs\r\n        var att = [];\r\n        for (var a = 1; a < obs[lev3].length; a++) {\r\n          if (obs[lev3][a] != null) {\r\n            //If there is more than 1 attribute value then add it to the notes, then it will be added to the footnotes.\r\n            if (!attribs[a - 1].isFootnote) {\r\n              att.push(attribs[a - 1].name + ': ' + attribs[a - 1].values[obs[lev3][a]].name);\r\n            }\r\n          }\r\n        }\r\n\r\n        rowAttribs.push(att.join('\\r\\n'));\r\n      }\r\n    }\r\n  });\r\n\r\n  return { rowDimVals: rowDimVals, row: row, rowAttribs: rowAttribs, dataStartIdx: dataStartIdx };\r\n};\r\n\r\nconst createFootnotes = attribs => {\r\n  const ret = [];\r\n\r\n  attribs.forEach(a => {\r\n    if (a.values && a.values.length != 0 && a.isFootnote) {\r\n      ret.push({ name: a.name, value: a.values[0].name });\r\n    }\r\n  });\r\n\r\n  return ret;\r\n};\r\n\r\nconst changeCellStyle = (cell, style) => {\r\n  cell.fill = {\r\n    type: 'pattern',\r\n    pattern: 'solid',\r\n    fgColor: { argb: style.fill },\r\n  };\r\n  var isBold = false;\r\n  if (style.bold) {\r\n    isBold = true;\r\n  }\r\n  cell.font = { color: { argb: style.color }, bold: isBold };\r\n};\r\nexport const generateExcel = async (data, layout, timeDimensionInverted) => {\r\n  const excel_styles = {\r\n    header: {\r\n      fill: 'FF47494e',\r\n      color: 'FFFFFFFF',\r\n    },\r\n    section: {\r\n      fill: 'FF47494e',\r\n      color: 'FFFFFFFF',\r\n    },\r\n    rowDim: {\r\n      fill: 'FFd9d9d9',\r\n      color: 'FF47494e',\r\n      bold: true,\r\n    },\r\n    rowDimValue: {\r\n      fill: 'FFd9d9d9',\r\n      color: 'FF47494e',\r\n    },\r\n    footnotesSection: {\r\n      bold: true,\r\n    },\r\n  };\r\n\r\n  var sections = [];\r\n  var header = [];\r\n  var rows = [];\r\n\r\n  const dims = data.data.structure.dimensions.observation;\r\n  const attribs = data.data.structure.attributes.observation;\r\n  const obs = data.data.dataSets[0].observations;\r\n\r\n  attribs.forEach(a => {\r\n    a.isFootnote = true;\r\n  });\r\n\r\n  var lastAttribKey = [];\r\n  const obs_keys = Object.keys(obs);\r\n\r\n  if (obs_keys.length > 1) {\r\n    obs[obs_keys[0]].forEach(a => {\r\n      lastAttribKey.push(a);\r\n    });\r\n\r\n    Object.keys(obs).forEach(o => {\r\n      for (var oidx = 1; oidx < obs[o].length; oidx++) {\r\n        if (lastAttribKey[oidx] != obs[o][oidx]) {\r\n          attribs[oidx - 1].isFootnote = false;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  dims.forEach(d => {\r\n    var vidx = 0;\r\n    d['__index'] = d.keyPosition;\r\n    d['label'] = d.name;\r\n    d.values.forEach(v => {\r\n      v['__index'] = vidx;\r\n      v['label'] = v.name;\r\n      vidx++;\r\n    });\r\n  });\r\n\r\n  var timeDim = dims.find(o => {\r\n    return o.id == TIME_PERIOD_ID;\r\n  });\r\n  const timeSort = function(a, b) {\r\n    if (a.start < b.start) return -1;\r\n    if (a.start > b.start) return 1;\r\n    return 0;\r\n  };\r\n  const timeSortInv = function(a, b) {\r\n    if (a.start > b.start) return -1;\r\n    if (a.start < b.start) return 1;\r\n    return 0;\r\n  };\r\n  if (timeDimensionInverted) {\r\n    timeDim = timeDim.values.sort(timeSortInv);\r\n  } else {\r\n    timeDim = timeDim.values.sort(timeSort);\r\n  }\r\n\r\n  if (layout) {\r\n    if (layout.sections) {\r\n      layout.sections.forEach(element => {\r\n        sections.push(getDimensionById(dims, element));\r\n      });\r\n    }\r\n    if (layout.header) {\r\n      layout.header.forEach(element => {\r\n        header.push(getDimensionById(dims, element));\r\n      });\r\n    }\r\n    if (layout.rows) {\r\n      layout.rows.forEach(element => {\r\n        rows.push(getDimensionById(dims, element));\r\n      });\r\n    }\r\n  } else {\r\n    rows = [dims[0]];\r\n    sections = dims.slice(1, dims.length);\r\n  }\r\n\r\n  const layout2 = { header: header, rows: rows, sections: sections };\r\n  const datakeys = [];\r\n  for (let [key, value] of Object.entries(obs)) {\r\n    datakeys.push(key);\r\n  }\r\n\r\n  const curated = getCuratedData({ observations: obs, layout: layout2 });\r\n  const curLay = getSortedLayout(layout2, obs);\r\n\r\n  const ExcelJS = require('exceljs');\r\n  var rowLen = 0;\r\n  var rowDimsLen = 0;\r\n\r\n  if (\r\n    curLay.sectionsData[0] &&\r\n    curLay.sectionsData[0][1] &&\r\n    curLay.sectionsData[0][1][0] &&\r\n    rowLen < curLay.sectionsData[0][1][0].length + 1\r\n  ) {\r\n    rowDimsLen = curLay.sectionsData[0][1][0].length;\r\n  }\r\n\r\n  if (curLay.headerData && curLay.headerData.length > 0) {\r\n    //rowlen is header (e.g. #years) + 1 (dim title) + it gets longer id there are 2 or more rowDims: rowDimsLen\r\n    //It should be #dimvalues on header + 1 (header title) + #rowDims -1(as one rowDim is under the header title)\r\n    //= #dimValues + #rowDims +1 -1 = #dimValues + #rowDims\r\n    rowLen = curLay.headerData.length + rowDimsLen;\r\n  }\r\n\r\n  const workbook = new ExcelJS.Workbook();\r\n  const sheet = workbook.addWorksheet('Unicef data');\r\n\r\n  var row = [];\r\n  //Create the header (columns) rows\r\n  if (curLay.headerData && curLay.headerData.length > 0) {\r\n    for (var rnum = 0; rnum < curLay.headerData[0].length; rnum++) {\r\n      row.push(curLay.headerData[0][rnum].dimension.name);\r\n\r\n      for (var col_shift = 0; col_shift < rowDimsLen - 1; col_shift++) row.push('');\r\n\r\n      curLay.headerData.forEach(h => {\r\n        row.push(h[rnum].value.name);\r\n      });\r\n      var r = sheet.addRow(row);\r\n\r\n      for (var i = 0; i < rowLen; i++) {\r\n        changeCellStyle(r.getCell(i + 1), excel_styles.header);\r\n      }\r\n\r\n      row = [];\r\n    }\r\n  }\r\n\r\n  //create the rows dimensions title row\r\n  row = [];\r\n  if (curLay.sectionsData && curLay.sectionsData.length > 0) {\r\n    curLay.sectionsData[0][1][0].forEach(s => {\r\n      row.push(s.dimension.name);\r\n    });\r\n    r = sheet.addRow(row);\r\n    for (i = 0; i < rowLen; i++) {\r\n      changeCellStyle(r.getCell(i + 1), excel_styles.rowDim);\r\n    }\r\n  }\r\n\r\n  //create sections and data rows\r\n  row = [];\r\n\r\n  //console.log(\"data\")\r\n  //console.log(data)\r\n\r\n  if (curLay.sectionsData) {\r\n    curLay.sectionsData.forEach(sec => {\r\n      var sectionText = '';\r\n      sec[0].forEach(secHead => {\r\n        sectionText = sectionText + secHead.dimension.name + ': ' + secHead.value.name + ' | ';\r\n      });\r\n\r\n      r = sheet.addRow([sectionText]);\r\n      for (i = 0; i < rowLen; i++) {\r\n        changeCellStyle(r.getCell(i + 1), excel_styles.section);\r\n      }\r\n      sec[1].forEach(datarow => {\r\n        var rowData = createDataRow(curLay.headerData, sec[0], datarow, curated, obs, attribs);\r\n        r = sheet.addRow();\r\n\r\n        var cellCount = 1;\r\n        var cell = null;\r\n        for (i = 0; i < rowData.rowDimVals.length; i++) {\r\n          cell = r.getCell(cellCount);\r\n          cell.value = rowData.rowDimVals[i];\r\n          changeCellStyle(cell, excel_styles.rowDimValue);\r\n          cellCount++;\r\n        }\r\n\r\n        for (i = 0; i < rowData.row.length; i++) {\r\n          cell = r.getCell(cellCount);\r\n          cell.value = rowData.row[i];\r\n          if (rowData.rowAttribs[i] != '') {\r\n            cell.note = rowData.rowAttribs[i];\r\n          }\r\n          cellCount++;\r\n        }\r\n\r\n        row = [];\r\n      });\r\n    });\r\n  }\r\n\r\n  //The footnotes\r\n  const footnotes = createFootnotes(attribs);\r\n  if (footnotes.length > 0) {\r\n    r = sheet.addRow();\r\n    r = sheet.addRow(['Footnotes']);\r\n    changeCellStyle(r.getCell(1), excel_styles.footnotesSection);\r\n  }\r\n  footnotes.forEach(f => {\r\n    //r = sheet.addRow([f.name, f.value]);\r\n    r = sheet.addRow([f.name + ': ' + f.value]);\r\n  });\r\n\r\n  const buf = await workbook.xlsx.writeBuffer();\r\n  return buf;\r\n};\r\n","import * as R from 'ramda';\r\nimport axios from 'axios';\r\nimport FileSaver from 'file-saver';\r\nimport { rules } from '@sis-cc/dotstatsuite-components';\r\nimport {\r\n  structureParser,\r\n  getConfig,\r\n  getFilename,\r\n  getFusionConfig,\r\n  dataflowsParser,\r\n  hierarchyParser,\r\n  getDataflowsConfig,\r\n  getHierarchyUrl,\r\n} from '../lib/sdmx';\r\nimport { sdmxRange } from '../lib/settings';\r\nimport * as fm from './formatMapper';\r\nimport { generateExcel } from '../lib/excel';\r\n\r\nconst getLocale = R.pathOr('en', ['locale', 'id']);\r\nconst keysLimit = 800;\r\n\r\nconst getStructure = ({ configArgs }) => {\r\n  const { url, datasource } =\r\n    R.prop('backendId', configArgs.dataflow) == 'FUSION'\r\n      ? getFusionConfig({ configArgs })\r\n      : getConfig({ type: 'structure' })({ configArgs });\r\n\r\n  const qStringParams =\r\n    R.prop('backendId', configArgs.dataflow) == 'FUSION'\r\n      ? //? { references: 'all', format: 'sdmx-json', detail: 'referencepartial'}\r\n        { format: 'sdmx-json', mode: 'exact', references: 'descendants' }\r\n      : { references: 'all' };\r\n\r\n  const acceptParam =\r\n    R.prop('backendId', configArgs.dataflow) == 'FUSION'\r\n      ? {\r\n          'Accept-Language': getLocale(configArgs),\r\n        }\r\n      : {\r\n          Accept: 'application/vnd.sdmx.structure+json;version=1.0',\r\n          'Accept-Language': getLocale(configArgs),\r\n        };\r\n\r\n  const addForcedDims=(configArgs, struct)=>{\r\n    if (!configArgs.dataflow.forcedDims) return;\r\n    Object.keys(configArgs.dataflow.forcedDims).forEach((k)=>{\r\n      struct.data.dataStructures[0].dataStructureComponents.dimensionList.dimensions.forEach(d=>{\r\n        if (d.id==k){\r\n          d.forced=configArgs.dataflow.forcedDims[k];\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  const mapSDMX_structure = data => {\r\n    addForcedDims(configArgs, data.data)\r\n    return data.data;\r\n  };\r\n  const mapSDMX_structureFusion = data => {\r\n    // console.log(\"PAMMM\")\r\n    // console.log(data.data)\r\n    // console.log(configArgs)\r\n    addForcedDims(configArgs, data.data)\r\n    console.log(\"PAMMM2\")\r\n    console.log(data.data)\r\n    return fm.mapStructure(data.data, configArgs.locale.id);\r\n  };\r\n\r\n  const sdmxMapperStruct =\r\n    R.prop('backendId', configArgs.dataflow) == 'FUSION'\r\n      ? mapSDMX_structureFusion\r\n      : mapSDMX_structure;\r\n\r\n  return (\r\n    axios\r\n      .get(url, {\r\n        params: R.cond([\r\n          [\r\n            R.always(R.prop('supportsReferencePartial', datasource)),\r\n            R.assoc('detail', 'referencepartial'),\r\n          ],\r\n          [R.T, R.identity],\r\n        ])(qStringParams),\r\n        headers: acceptParam,\r\n      })\r\n      //.then(R.pipe(R.prop('data'), structureParser));\r\n      .then(R.pipe(sdmxMapperStruct, structureParser))\r\n  );\r\n};\r\n\r\nconst getData = ({ configArgs, requestArgs, dimensions }) => {\r\n\r\n  // configArgs.dataquery=\"AFG\"+configArgs.dataquery;\r\n  \r\n\r\n\r\n  const { url, datasource } = getConfig({ type: 'data' })({ configArgs });\r\n\r\n  console.log(\"getting_data\")\r\n  console.log(configArgs)\r\n  console.log(requestArgs)\r\n  console.log(url)\r\n  console.log(\"dimensions\")\r\n  console.log(dimensions)\r\n  \r\n\r\n  const limitData = data => {\r\n    const dataNode = data.data;\r\n    const keys = Object.keys(dataNode.dataSets[0].observations);\r\n\r\n    dataNode.dataSets[0].limited = {\r\n      returnedKeyCount: keys.length,\r\n      limitedTo: keysLimit,\r\n    };\r\n    if (keys.length > keysLimit) {\r\n      for (let i = keysLimit; i < keys.length; i++)\r\n        delete dataNode.dataSets[0].observations[keys[i]];\r\n    }\r\n  };\r\n\r\n  if (requestArgs.lastnobservations) {\r\n    requestArgs.lastnobservations = 1;\r\n  } else {\r\n    delete requestArgs.lastnobservations;\r\n  }\r\n\r\n  const mapSDMX_data = data => {\r\n    limitData(data);\r\n    return data.data;\r\n  };\r\n  const mapSDMX_dataFusion = data => {\r\n    limitData(data.data);\r\n    return fm.mapData(data.data, configArgs.locale.id);\r\n  };\r\n\r\n  const sdmxMapperData =\r\n    R.prop('backendId', configArgs.dataflow) == 'FUSION' ? mapSDMX_dataFusion : mapSDMX_data;\r\n\r\n  return (\r\n    axios\r\n      .get(url, {\r\n        params: R.mergeRight({ dimensionAtObservation: 'AllDimensions' }, requestArgs),\r\n        headers: R.cond([\r\n          [\r\n            R.always(R.prop('hasRangeHeader', datasource)),\r\n            R.assoc('Range', `values=${R.head(sdmxRange)}-${R.last(sdmxRange)}`),\r\n          ],\r\n          [R.T, R.identity],\r\n        ])({\r\n          Accept: 'application/vnd.sdmx.data+json;version=1.0.0-wd',\r\n          'Accept-Language': getLocale(configArgs),\r\n        }),\r\n      })\r\n      //.then(R.pipe(R.prop('data'), rules.v8Transformer));\r\n      .then(R.pipe(sdmxMapperData, rules.v8Transformer))\r\n  );\r\n};\r\n\r\nconst getDataFile = ({ configArgs, requestArgs }) => {\r\n  const { url } = getConfig({ type: 'data' })({ configArgs });\r\n\r\n  if (requestArgs.lastnobservations) {\r\n    requestArgs.lastnobservations = 1;\r\n  } else {\r\n    delete requestArgs.lastnobservations;\r\n  }\r\n\r\n  let accept = 'application/vnd.sdmx.data+csv;file=true';\r\n  if (configArgs.dataflow.backendId && configArgs.dataflow.backendId == 'FUSION') {\r\n    requestArgs['format'] = 'csv';\r\n    requestArgs['labels'] = 'name';\r\n    accept = '';\r\n  }\r\n\r\n  return axios\r\n    .get(url, {\r\n      params: requestArgs,\r\n      //params:{format:\"csv\",labels:\"name\"},\r\n      headers: {\r\n        Accept: accept,\r\n        'Accept-Language': getLocale(configArgs),\r\n      },\r\n      responseType: 'blob',\r\n    })\r\n    .then(response => {\r\n      const blob = new Blob([R.prop('data')(response)], {\r\n        type: R.pathOr('text/csv', ['headers', 'content-type'])(response),\r\n      });\r\n      FileSaver.saveAs(blob, `${getFilename(configArgs)}.csv`);\r\n    });\r\n};\r\n\r\nconst getExcelDataFile = ({ configArgs, requestArgs, layout, timeDimensionInverted }) => {\r\n  const { url, datasource } = getConfig({ type: 'data' })({ configArgs });\r\n\r\n  if (requestArgs.lastnobservations) {\r\n    requestArgs.lastnobservations = 1;\r\n  } else {\r\n    delete requestArgs.lastnobservations;\r\n  }\r\n\r\n  /*const sdmxMapperData =\r\n    R.prop('backendId', configArgs.dataflow) == 'FUSION' ? mapSDMX_dataFusion : mapSDMX_data;*/\r\n\r\n  return (\r\n    axios\r\n      .get(url, {\r\n        params: R.mergeRight({ dimensionAtObservation: 'AllDimensions' }, requestArgs),\r\n        headers: R.cond([\r\n          [\r\n            R.always(R.prop('hasRangeHeader', datasource)),\r\n            R.assoc('Range', `values=${R.head(sdmxRange)}-${R.last(sdmxRange)}`),\r\n          ],\r\n          [R.T, R.identity],\r\n        ])({\r\n          Accept: 'application/vnd.sdmx.data+json;version=1.0.0-wd',\r\n          'Accept-Language': getLocale(configArgs),\r\n        }),\r\n      })\r\n      //.then(R.pipe(R.prop('data'), rules.v8Transformer));\r\n      .then(response => {\r\n        generateExcel(response.data, layout, timeDimensionInverted).then(response => {\r\n          const blob = new Blob([response], { type: 'application/vnd.ms-excel' });\r\n          //FileSaver.saveAs(blob, `data.xlsx`);\r\n          var yStart = '';\r\n          var yEnd = '';\r\n          if (requestArgs.startPeriod) yStart = requestArgs.startPeriod;\r\n          if (requestArgs.endPeriod) yEnd = requestArgs.endPeriod;\r\n          FileSaver.saveAs(blob, `${configArgs.dataflow.dataflowId}_${yStart}-${yEnd}.xlsx`);\r\n        });\r\n      })\r\n  );\r\n};\r\n\r\n//Is any mapping needed for Fusion?\r\n//The getDataflows method has been implemented working with fusion map dotStat id needed\r\nconst sdmxMapperDataflows = dataflows => {\r\n  //No mapping needed for Fusion, just return\r\n  return dataflows;\r\n};\r\n\r\n//Is any mapping needed for Fusion?\r\n//The getHierarchy method has been implemented working with fusion map dotStat if needed\r\nconst sdmxMapperHierarchy = hierarchy => {\r\n  //No mapping needed for Fusion, just return\r\n  return hierarchy.data;\r\n};\r\n\r\nconst getDataflows = ({ configArgs }) => {\r\n  const { url, datasource } =\r\n    R.prop('backendId', configArgs.dataflow) == 'FUSION'\r\n      ? getDataflowsConfig({ configArgs })\r\n      : getConfig({ type: 'dataflows' })({ configArgs });\r\n\r\n  return axios\r\n    .get(url, {\r\n      params: {\r\n        format: 'sdmx-json',\r\n        detail: 'full',\r\n        references: 'children',\r\n        includeMetadata: true,\r\n        /*includeMetrics: false,*/\r\n        /*includeAllAnnotations: false,*/\r\n      },\r\n      headers: { Accept: 'application/json', 'Accept-Language': getLocale(configArgs) },\r\n    })\r\n    .then(R.pipe(sdmxMapperDataflows, dataflowsParser));\r\n};\r\n\r\nconst getHierarchy = ({ configArgs }) => {\r\n  const url = getHierarchyUrl({ configArgs });\r\n  return axios\r\n    .get(url, {\r\n      params: {\r\n        format: 'sdmx-json',\r\n        detail: 'full',\r\n        references: 'children',\r\n      },\r\n      headers: { Accept: 'application/json', 'Accept-Language': getLocale(configArgs) },\r\n    })\r\n    .then(R.pipe(sdmxMapperHierarchy, hierarchyParser));\r\n};\r\n\r\nconst methods = {\r\n  getStructure,\r\n  getData,\r\n  getDataFile,\r\n  getDataflows,\r\n  getHierarchy,\r\n  getExcelDataFile,\r\n};\r\n\r\nconst error = method => () => {\r\n  throw new Error(`Unkown method: ${method}`);\r\n};\r\nconst main = ({ method, ...rest }) => (methods[method] || error(method))(rest);\r\nR.compose(R.forEach(([name, fn]) => (main[name] = fn)), R.toPairs)(methods);\r\n\r\nexport default main;\r\n","import * as R from 'ramda';\r\nimport {\r\n  getDataflow,\r\n  getPeriod,\r\n  getLastnobservations,\r\n  getLayout,\r\n  getTimeDimensionInverted,\r\n} from '../selectors/vis';\r\nimport { getLocale } from '../selectors/app';\r\nimport { getDataquery } from '../selectors/sdmx';\r\nimport sdmxApi from '../api/sdmx';\r\nimport { OVERRIDE_DATAQUERY } from './vis';\r\nimport { setPending, pushLog, LOG_ERROR } from './app';\r\nimport { getDimensions } from '../selectors/sdmx';\r\n\r\nconst isDev = process.env.NODE_ENV === 'development';\r\n\r\n//-----------------------------------------------------------------------------------------constants\r\nexport const HANDLE_STRUCTURE = '@@sdmx/HANDLE_STRUCTURE';\r\nexport const HANDLE_DATA = '@@sdmx/HANDLE_DATA';\r\nexport const HANDLE_DATAFLOWS = '@@sdmx/HANDLE_DATAFLOWS';\r\nexport const HANDLE_HIERARCHY = '@@sdmx/HANDLE_HIERARCHY';\r\n\r\n//--------------------------------------------------------------------------------------thunks (api)\r\nconst request = (dispatch, ctx) => {\r\n  const { method } = ctx;\r\n  const pendingId = ctx.pendingId || method;\r\n\r\n  // eslint-disable-next-line no-console\r\n  if (isDev) console.info(`request: ${pendingId}`);\r\n\r\n  dispatch(setPending(pendingId, true));\r\n  return sdmxApi(ctx)\r\n    .then(res => {\r\n      dispatch(setPending(pendingId));\r\n      return res;\r\n    })\r\n    .catch(error => {\r\n      const log = error.response\r\n        ? { method, errorCode: error.response.data.errorCode, statusCode: error.response.status }\r\n        : { method, error };\r\n\r\n      dispatch(setPending(pendingId));\r\n      dispatch(pushLog({ type: LOG_ERROR, payload: { log } }));\r\n\r\n      // required to break the promised chain\r\n      throw error;\r\n    });\r\n};\r\n\r\n/*\r\nThis method tries to fix a wrong dataquery param:\r\nThe user selected a code that is not available in the dimension, instead of showing a \"No data\" error it removes the code from the selection\r\n*/\r\nconst cleanDataQueryAgainstStructure = (dataquery, dims) => {\r\n  if (!dataquery || dataquery == '') return dataquery;\r\n\r\n  console.log(\"CCCCCCCCCCCCClean\")\r\n  console.log(dataquery)\r\n  console.log(dims)\r\n\r\n  // R.getIndex\r\n\r\n  let dqParts = dataquery.split('.');\r\n\r\n  for (let i = 0; i < dqParts.length; i++) {\r\n    if (dims[i] && dims[i].forced && dims[i].forced!=null)\r\n    dqParts[i]=dims[i].forced;\r\n\r\n    if (dqParts[i] == '') continue;\r\n    if (!dims[i] || !dims[i].values) continue; //Just to avoid breaking if some dots are accidentally added at the end\r\n    var dimCodes = dqParts[i].split('+');\r\n\r\n      console.log(dimCodes)\r\n    \r\n\r\n    // const dimCodes = dqParts[i].split('+');\r\n    for (let c = dimCodes.length - 1; c >= 0; c--) {\r\n      const found = dims[i].values.some(code => code.id == dimCodes[c]);\r\n      if (!found) {\r\n        dimCodes.splice(c, 1);\r\n      }\r\n    }\r\n    dqParts[i] = dimCodes.join('+');\r\n  }\r\n\r\n  console.log(dqParts)\r\n\r\n  return dqParts.join('.');\r\n};\r\n\r\nexport const requestStructure = ({ shouldRequestStructure }) => (dispatch, getState) => {\r\n  if (R.not(shouldRequestStructure)) return Promise.resolve();\r\n\r\n  const configArgs = {\r\n    locale: getLocale(getState()),\r\n    dataflow: getDataflow(getState()),\r\n  };\r\n  return request(dispatch, { method: 'getStructure', configArgs }).then(structure => {\r\n    dispatch({ type: HANDLE_STRUCTURE, structure });\r\n  });\r\n};\r\n\r\nexport const requestData = ({ shouldRequestStructure } = {}) => (dispatch, getState) => {\r\n  requestStructure({ shouldRequestStructure })(dispatch, getState).then(() => {\r\n    const requestArgs = {\r\n      startPeriod: R.head(getPeriod(getState())),\r\n      endPeriod: R.last(getPeriod(getState())),\r\n      lastnobservations: getLastnobservations(getState()),\r\n    };\r\n    const dataquery = cleanDataQueryAgainstStructure(\r\n      getDataquery(getState()),\r\n      getDimensions(getState()),\r\n    );\r\n    const dataflow = getDataflow(getState());\r\n    const configArgs = {\r\n      locale: getLocale(getState()),\r\n      dataflow,\r\n      dataquery,\r\n    };\r\n\r\n    const dims = getDimensions(getState());\r\n    console.log(\"REQ data\")\r\n    console.log(dims)\r\n    console.log(dataquery)\r\n\r\n    dispatch({ type: OVERRIDE_DATAQUERY, dataquery });\r\n    return request(dispatch, { method: 'getData', configArgs, requestArgs,dims })\r\n      .then(({ data, layout }) => {\r\n        // UNICEF specific\r\n        document.getElementById('root').dispatchEvent(\r\n          new CustomEvent('unicef_dataflowLoaded', {\r\n            detail: {\r\n              dataflow,\r\n              data,\r\n              dataquery,\r\n              requestArgs,\r\n            },\r\n          }),\r\n        );\r\n\r\n        dispatch({ type: HANDLE_DATA, data, layout });\r\n        document.getElementById('root').dispatchEvent(new CustomEvent('data_loaded'));\r\n      })\r\n      .catch(error => {\r\n        let nodata = null;\r\n        let nolayout = null;\r\n        dispatch({ type: HANDLE_DATA, nodata, nolayout });\r\n      });\r\n  });\r\n};\r\n\r\nexport const requestDataFile = ({ isDownloadAllData, dataflow } = {}) => (dispatch, getState) => {\r\n  const requestArgs = isDownloadAllData\r\n    ? {}\r\n    : {\r\n        startPeriod: R.head(getPeriod(getState())),\r\n        endPeriod: R.last(getPeriod(getState())),\r\n        lastnobservations: getLastnobservations(getState()),\r\n      };\r\n  const configArgs = R.cond([\r\n    [R.always(R.not(isDownloadAllData)), R.assoc('dataquery', getDataquery(getState()))],\r\n    [R.T, R.identity],\r\n  ])({\r\n    locale: getLocale(getState()),\r\n    dataflow,\r\n  });\r\n  const pendingId = R.ifElse(\r\n    R.has('id'),\r\n    R.pipe(R.prop('id'), id => `getDataFile/${id}`),\r\n    R.always('requestingDataFile'),\r\n  )(dataflow);\r\n  return request(dispatch, { method: 'getDataFile', configArgs, requestArgs, pendingId });\r\n};\r\n\r\nexport const requestExcelDataFile = ({ isDownloadAllData, dataflow } = {}) => (\r\n  dispatch,\r\n  getState,\r\n) => {\r\n  console.log('getState()');\r\n  console.log('getState()');\r\n  console.log('getState()');\r\n  console.log(getState());\r\n\r\n  const requestArgs = isDownloadAllData\r\n    ? {}\r\n    : {\r\n        startPeriod: R.head(getPeriod(getState())),\r\n        endPeriod: R.last(getPeriod(getState())),\r\n        lastnobservations: getLastnobservations(getState()),\r\n      };\r\n  const configArgs = R.cond([\r\n    [R.always(R.not(isDownloadAllData)), R.assoc('dataquery', getDataquery(getState()))],\r\n    [R.T, R.identity],\r\n  ])({\r\n    locale: getLocale(getState()),\r\n    dataflow,\r\n  });\r\n  const pendingId = R.ifElse(\r\n    R.has('id'),\r\n    R.pipe(R.prop('id'), id => `getDataFile/${id}`),\r\n    R.always('requestingDataFile'),\r\n  )(dataflow);\r\n  const layout = getLayout(getState());\r\n  const timeDimensionInverted = getTimeDimensionInverted(getState())['TIME_PERIOD'];\r\n\r\n  return request(dispatch, {\r\n    method: 'getExcelDataFile',\r\n    configArgs,\r\n    requestArgs,\r\n    pendingId,\r\n    layout,\r\n    timeDimensionInverted,\r\n  });\r\n};\r\n\r\nexport const requestDataflows = () => (dispatch, getState) => {\r\n  const configArgs = {\r\n    locale: getLocale(getState()),\r\n    dataflow: getDataflow(getState()),\r\n  };\r\n  return request(dispatch, { method: 'getDataflows', configArgs }).then(dataflows => {\r\n    dispatch({ type: HANDLE_DATAFLOWS, dataflows });\r\n  });\r\n};\r\n\r\nexport const requestHierachy = h => (dispatch, getState) => {\r\n  const configArgs = h;\r\n  return request(dispatch, { method: 'getHierarchy', configArgs }).then(hierarchy => {\r\n    dispatch({ type: HANDLE_HIERARCHY, hierarchy });\r\n  });\r\n};\r\n\r\n//-------------------------------------------------------------------------------------------reducer\r\nexport default (state = {}, action = {}) => {\r\n  switch (action.type) {\r\n    case HANDLE_STRUCTURE:\r\n      return R.set(R.lensProp('dimensions'), R.path(['structure', 'dimensions'], action), state);\r\n    case HANDLE_DATA:\r\n      return R.pipe(\r\n        R.set(R.lensProp('data'), R.prop('data', action)),\r\n        R.set(R.lensProp('layout'), R.prop('layout', action)),\r\n      )(state);\r\n    case HANDLE_DATAFLOWS:\r\n      return R.set(R.lensProp('dataflows'), R.prop('dataflows', action), state);\r\n    case HANDLE_HIERARCHY:\r\n      return R.set(R.lensProp('hierarchy'), R.prop('hierarchy', action), state);\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n","import { combineReducers } from 'redux';\r\nimport app from '../ducks/app';\r\nimport vis from '../ducks/vis';\r\nimport sdmx from '../ducks/sdmx';\r\n\r\nexport default combineReducers({ app, sdmx, vis });\r\n","import * as R from 'ramda';\r\nimport {\r\n  CHANGE_DATAQUERY,\r\n  CHANGE_PERIOD,\r\n  CHANGE_DATAFLOW,\r\n  CHANGE_LASTNOBS,\r\n  LOAD_DATAFLOWS,\r\n  LOAD_HIERARCHY,\r\n} from '../ducks/vis';\r\nimport { requestData, requestDataflows, requestHierachy } from '../ducks/sdmx';\r\n\r\nconst isDev = process.env.NODE_ENV === 'development';\r\n\r\nexport const requestDataMiddleware = ({ dispatch }) => next => action => {\r\n  const future = next(action);\r\n\r\n  if (\r\n    R.pipe(R.prop('type'), R.flip(R.includes)([CHANGE_DATAQUERY, CHANGE_PERIOD, CHANGE_LASTNOBS]))(\r\n      action,\r\n    )\r\n  ) {\r\n    // eslint-disable-next-line no-console\r\n    if (isDev) console.info(`requestDataMiddleware: ${action.type}`);\r\n\r\n    dispatch(requestData());\r\n  }\r\n\r\n  if (R.pipe(R.prop('type'), R.flip(R.includes)([CHANGE_DATAFLOW]))(action)) {\r\n    // eslint-disable-next-line no-console\r\n    if (isDev) console.info(`requestStructureMiddleware: ${action.type}`);\r\n\r\n    dispatch(requestData({ shouldRequestStructure: true }));\r\n  }\r\n\r\n  if (action.type == LOAD_DATAFLOWS) {\r\n    if (isDev) console.info(`requestStructureMiddleware: ${action.type}`);\r\n    dispatch(requestDataflows());\r\n  }\r\n\r\n  if (action.type == LOAD_HIERARCHY) {\r\n    if (isDev) console.info(`requestHierarchyMiddleware: ${action.type}`);\r\n    dispatch(requestHierachy(action.payload));\r\n  }\r\n\r\n  return future;\r\n};\r\n","import { createStore, applyMiddleware, compose } from 'redux';\r\nimport thunk from 'redux-thunk';\r\nimport { createLogger } from 'redux-logger';\r\nimport { requestDataMiddleware } from './middlewares';\r\n\r\nexport const withLogger = middlewares => {\r\n  if (process.env.NODE_ENV === 'production') return middlewares;\r\n\r\n  const logger = createLogger({\r\n    duration: true,\r\n    timestamp: false,\r\n    collapsed: true,\r\n    diff: true,\r\n  });\r\n\r\n  return [...middlewares, logger];\r\n};\r\n\r\nexport default (initialState = {}, rootReducer) => {\r\n  const middlewares = [thunk, requestDataMiddleware];\r\n\r\n  const enhancers = [applyMiddleware(...withLogger(middlewares))];\r\n\r\n  const store = createStore(rootReducer, initialState, compose(...enhancers));\r\n\r\n  return store;\r\n};\r\n","import { createMuiTheme } from '@material-ui/core/styles';\r\n\r\nexport const Colors = {\r\n  GREY1: '#F0F0F0',\r\n  GREY2: '#CCCCCC',\r\n  GREY3: '#494444',\r\n  GREY4: '#A4A1A1',\r\n  GREY5: '#666666',\r\n  BLUE1: '#2973BD',\r\n  BLUE2: '#0965C1',\r\n  BLUE3: '#2F75B5',\r\n  BLUE4: '#BDD7EE',\r\n  BLUE5: '#DDEBF7',\r\n  BLUE6: '#1E226A',\r\n  WHITE1: '#FFFFFF',\r\n  BLACK1: '#000000',\r\n  GREEN1: '#8CC841',\r\n  ORANGE: '#f7a32c',\r\n};\r\n\r\nexport const FontSizes = {\r\n  SIZE1: 18,\r\n  SIZE2: 14,\r\n  SIZE3: 12,\r\n};\r\n\r\nexport const Formats = {\r\n  WIDE: 'initial',\r\n  NARROW: 400,\r\n  APP: 1000,\r\n  APP_MIN_SIZE: 360,\r\n  ITEM_MIN_SIZE: 350,\r\n};\r\n\r\nexport const Layout = {\r\n  PADDING: '5%',\r\n  SIDE_WIDTH: 300,\r\n  FILTER_MAX_HEIGHT: 250,\r\n};\r\n\r\nexport const theme = (rtl = 'ltr') =>\r\n  createMuiTheme({\r\n    overrides: {\r\n      MuiButton: {\r\n        text: {\r\n          textTransform: 'none',\r\n        },\r\n      },\r\n    },\r\n    palette: {\r\n      primary: {\r\n        main: '#137cbd',\r\n        mainAlpha: '#137cbd26',\r\n        light: '#5dabf0',\r\n        dark: '#00508c',\r\n        contrastText: '#ffffff',\r\n      },\r\n      secondary: {\r\n        main: '#bdd7ee',\r\n        light: '#f0ffff',\r\n        dark: '#8ca6bc',\r\n        contrastText: '#ff0000',\r\n      },\r\n      action: {\r\n        hover: '#bdd7ee',\r\n        selected: '#137cbd',\r\n        active: 'rgba(19,124,189,.3)',\r\n      },\r\n      typography: {\r\n        fontFamily: ['Segoe UI'],\r\n      },\r\n      raisedButton: {\r\n        textColor: '#ffffff',\r\n        primaryTextColor: '#ffffff',\r\n      },\r\n      default: {\r\n        backgroundColor: '#00000026', // grey with alpha\r\n      },\r\n      configLabelBG: '#B5CEEB',\r\n      configLabelCol: '#1C2768',\r\n    },\r\n    app: {\r\n      appSize: Formats.APP,\r\n      appMinSize: Formats.APP_MIN_SIZE,\r\n      itemMinSize: Formats.ITEM_MIN_SIZE,\r\n    },\r\n    scopeListContainer: {\r\n      maxHeight: 250,\r\n    },\r\n    scopeList: {\r\n      divider: '#000000',\r\n    },\r\n    direction: rtl,\r\n    typography: {\r\n      // until v4 https://material-ui.com/style/typography/#migration-to-typography-v2\r\n      useNextVariants: true,\r\n    },\r\n    configLabel: {\r\n      backgroundColor: '#B5CEEB',\r\n      color: '#43679F',\r\n      fontFamily: 'Segoe UI',\r\n      fontSize: 16,\r\n    },\r\n    configButtonRegular: {\r\n      backgroundColor: '#B5CEEB',\r\n      color: '#43679F',\r\n      fontFamily: 'Segoe UI',\r\n      fontSize: 16,\r\n      fontWeight: 'inherit',\r\n      textTransform: 'none',\r\n    },\r\n    configButtonSelected: {\r\n      backgroundColor: '#778899',\r\n      color: '#B5CEEB',\r\n      fontFamily: 'Segoe UI',\r\n      fontSize: 16,\r\n      fontWeight: 'inherit',\r\n      textTransform: 'none',\r\n    },\r\n    panelSummary: {\r\n      backgroundColor: '#137cbd',\r\n      color: 'white',\r\n      fontFamily: 'Segoe UI',\r\n      fontSize: 16,\r\n    },\r\n    panelIcon: {\r\n      color: 'white',\r\n    },\r\n    configInputs: {\r\n      backgroundColor: 'white',\r\n    },\r\n    alert: {\r\n      color: '#c23030',\r\n      hover: {\r\n        backgroundColor: 'rgba(219,55,55,.15)',\r\n      },\r\n      active: {\r\n        backgroundColor: 'rgba(219,55,55,.3)',\r\n      },\r\n    },\r\n    table: {\r\n      yBg: '#B5CEEB',\r\n      yBgHover: '#c3d7ef',\r\n      yBgActive: '#7e90a4',\r\n      yFontHeader: '#1C2768',\r\n      yFont: '#43679F',\r\n      zBg: '#386CAA',\r\n      zBgHover: '#5f89bb',\r\n      zBgActive: '#274b76',\r\n      zFontHeader: '#A2C2E4',\r\n      zFont: Colors.WHITE1,\r\n      xBg: Colors.WHITE1,\r\n      xBgHeader: '#D7E6F4',\r\n      xBgHover: '#dfebf6',\r\n      xBgActive: '#96a1aa',\r\n      xFontHeader: '#1C2768',\r\n      xFont: '#43679F',\r\n      oFont: Colors.GREY3,\r\n      sBg: Colors.GREY1,\r\n    },\r\n  });\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { mergeDeepRight } from 'ramda';\r\nimport { ThemeProvider } from 'glamorous';\r\nimport { mainTheme } from '@sis-cc/dotstatsuite-ui-components';\r\nimport rtl from 'jss-rtl';\r\nimport { create } from 'jss';\r\nimport { MuiThemeProvider } from '@material-ui/core/styles';\r\nimport { theme as muiTheme } from './theme';\r\nimport JssProvider from 'react-jss/lib/JssProvider';\r\nimport { createGenerateClassName, jssPreset } from '@material-ui/core/styles';\r\n\r\n// Configure JSS\r\nconst jss = create({ plugins: [...jssPreset().plugins, rtl()] });\r\n// Custom Material-UI class name generator.\r\nconst generateClassName = createGenerateClassName();\r\n\r\nconst Provider = ({ theme, children, isRtl }) => (\r\n  <JssProvider jss={jss} generateClassName={generateClassName}>\r\n    <MuiThemeProvider theme={muiTheme(isRtl ? 'rtl' : 'ltr')}>\r\n      <ThemeProvider theme={mergeDeepRight(mainTheme, theme)}>\r\n        {React.Children.only(children)}\r\n      </ThemeProvider>\r\n    </MuiThemeProvider>\r\n  </JssProvider>\r\n);\r\n\r\nProvider.propTypes = {\r\n  theme: PropTypes.object,\r\n  children: PropTypes.element.isRequired,\r\n  isRtl: PropTypes.bool,\r\n};\r\n\r\nexport default Provider;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { DELayout, DELayoutContent, DESplash } from '@sis-cc/dotstatsuite-ui-components';\r\nimport logo from '../assets/data-explorer-logo.png';\r\n\r\nclass ErrorBoundary extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { hasError: false };\r\n  }\r\n\r\n  componentDidCatch() {\r\n    this.setState({ hasError: true });\r\n  }\r\n\r\n  render() {\r\n    if (!this.state.hasError) return this.props.children;\r\n\r\n    if (this.props.isFinal) return <h1>Whoops, something went wrong on our end.</h1>;\r\n\r\n    return (\r\n      <DELayout isHome>\r\n        <DELayoutContent>\r\n          <DESplash title={<FormattedMessage id=\"de.error.title\" />} logo={logo} />\r\n        </DELayoutContent>\r\n      </DELayout>\r\n    );\r\n  }\r\n}\r\n\r\nErrorBoundary.propTypes = {\r\n  children: PropTypes.node,\r\n  isFinal: PropTypes.bool,\r\n};\r\n\r\nexport default ErrorBoundary;\r\n","import React, { Fragment } from 'react';\r\nimport Responsive from 'react-responsive';\r\n\r\nconst Narrow = props => <Responsive {...props} query={`(max-width: ${700}px)`} />;\r\nconst Default = props => <Responsive {...props} query={`(min-width: ${700 + 1}px)`} />;\r\n\r\nexport default Component =>\r\n  class extends React.Component {\r\n    render = () => (\r\n      <Fragment>\r\n        <Narrow>\r\n          <Component {...this.props} isNarrow />\r\n        </Narrow>\r\n        <Default>\r\n          <Component {...this.props} />\r\n        </Default>\r\n      </Fragment>\r\n    );\r\n  };\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps, pure } from 'recompose';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { DEFilterPeriod } from '@sis-cc/dotstatsuite-ui-components';\r\nimport { changePeriod } from '../../ducks/vis';\r\nimport { getPeriod } from '../../selectors/vis';\r\nimport { sdmxPeriodBoundariesMinMax, sdmxPeriodBoundaries } from '../../lib/settings';\r\n\r\nexport default compose(\r\n  connect(createStructuredSelector({ period: getPeriod }), { changePeriod }),\r\n  withProps({\r\n    //titleLabel: <FormattedMessage id=\"de.filter.period.title\" />,\r\n    titleLabel: '',\r\n    //tagLabel: <FormattedMessage id=\"de.filter.period.tag\" values={sdmxPeriodBoundariesMinMax} />,\r\n    tagLabel: '',\r\n    periodBoundaries: sdmxPeriodBoundaries,\r\n    options: { ...sdmxPeriodBoundariesMinMax, labelStepSize: 10 },\r\n  }),\r\n  pure,\r\n)(DEFilterPeriod);\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps, pure } from 'recompose';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { VXFiltersCurrent } from '@sis-cc/dotstatsuite-ui-components';\r\nimport { changeDataquery } from '../../ducks/vis';\r\nimport { getSelection } from '../../selectors/sdmx';\r\n\r\nexport default compose(\r\n  connect(createStructuredSelector({ items: getSelection }), { changeFilters: changeDataquery }),\r\n  withProps({\r\n    titleLabel: <FormattedMessage id=\"vx.filters.current.title\" />,\r\n    clearAllLabel: <FormattedMessage id=\"vx.filters.current.clear\" />,\r\n    blankLabel: <FormattedMessage id=\"vx.filters.current.blank\" />,\r\n    noScroll: true,\r\n  }),\r\n  pure,\r\n)(VXFiltersCurrent);\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps, pure } from 'recompose';\r\nimport * as R from 'ramda';\r\nimport { injectIntl } from 'react-intl';\r\nimport {\r\n  spotlightScopeListEngine,\r\n  VXScopeList,\r\n  VXSpotlight,\r\n} from '@sis-cc/dotstatsuite-ui-components';\r\nimport { changeFilter, changeDataquery } from '../../ducks/vis';\r\nimport { getFilter } from '../../selectors/vis';\r\nimport { getFilters } from '../../selectors/sdmx';\r\n\r\nconst Filter = pure(VXScopeList);\r\n\r\nexport default compose(\r\n  injectIntl,\r\n  connect(createStructuredSelector({ filters: getFilters, activePanelId: getFilter }), {\r\n    changeSelection: changeDataquery,\r\n    onChangeActivePanel: changeFilter,\r\n  }),\r\n  withProps(({ intl }) => ({\r\n    optionsSpotlight: {\r\n      hasClearAll: true,\r\n      mainPlaceholder: intl.formatMessage({ id: 'vx.spotlight.placeholder.primary' }),\r\n      secondaryPlaceholder: intl.formatMessage({ id: 'vx.spotlight.placeholder.secondary' }),\r\n    },\r\n    spotlight: {\r\n      engine: spotlightScopeListEngine,\r\n      placeholder: intl.formatMessage({ id: 'vx.spotlight.placeholder' }),\r\n      fields: {\r\n        'vx.spotlight.field.label': {\r\n          id: 'vx.spotlight.field.label',\r\n          accessor: R.pipe(R.propOr(null, 'label'), R.ifElse(R.isNil, R.always(''), R.identity)),\r\n          isSelected: true,\r\n        },\r\n      },\r\n    },\r\n    topElementComponent: values => (R.gte(R.length(values), 8) ? VXSpotlight : null),\r\n  })),\r\n  pure,\r\n)(({ topElementComponent, filters, ...parentProps }) =>\r\n  R.map(\r\n    ({ id, label, values }) => (\r\n      <Filter\r\n        {...parentProps}\r\n        id={id}\r\n        key={id}\r\n        label={label}\r\n        items={values}\r\n        TopElementComponent={topElementComponent(values)}\r\n      />\r\n    ),\r\n    filters,\r\n  ),\r\n);\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport PropTypes from 'prop-types';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nclass Lastnobs extends React.Component {\r\n  render() {\r\n    return (\r\n      <div className=\"div_lastnobs\">\r\n        <label>\r\n          <input\r\n            name=\"lastnobs\"\r\n            type=\"checkbox\"\r\n            checked={this.props.lastnobs}\r\n            onChange={() => this.props.changeLastnobs(!this.props.lastnobs)}\r\n          />\r\n          <FormattedMessage id=\"de.filter.period.lastnobs\" />\r\n        </label>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nLastnobs.propTypes = {\r\n  lastnobs: PropTypes.bool,\r\n  changeLastnobs: PropTypes.func,\r\n};\r\n\r\nconst withProps = state => {\r\n  let lastn = false;\r\n  if (state.vis && state.vis.lastnobservations) {\r\n    lastn = true;\r\n  }\r\n  return {\r\n    lastnobs: lastn,\r\n  };\r\n};\r\n\r\nfunction mapDispatchToProps(dispatch, props) {\r\n  return {\r\n    changeLastnobs: lastnobs =>\r\n      dispatch({\r\n        type: '@@vis/sdmx/CHANGE_LASTNOBS',\r\n        payload: { lastnobservations: lastnobs },\r\n      }),\r\n  };\r\n}\r\n\r\nexport default connect(withProps, mapDispatchToProps)(Lastnobs);\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport PropTypes from 'prop-types';\r\nimport { getSelection, getDataflows } from '../../selectors/sdmx';\r\nimport { getDataflow, getPeriod } from '../../selectors/vis';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\n//build the selection for each dimension e.g. REF_AREA = AFG+ITA\r\nconst dim_selection = (df_id, dim, selection) => {\r\n  if (!selection) return '';\r\n\r\n  //is it there a selection for the dimension?\r\n  let sel = selection.filter(s => s.id == dim);\r\n  if (sel.length == 0) return ''; //no-> return\r\n\r\n  return sel[0].values.map(elem => elem.id).join('+');\r\n};\r\n\r\n//creates the link to the specific sector's dataflow\r\nconst createLink = (df_id, dataflow, selection, period, stickyDims) => {\r\n  //build the dataquery, for each dimension compose the list of selected codes (AFG+ITA.U5MR._T)\r\n  let dq = [];\r\n\r\n  dataflow.dimensions.forEach(dim => {\r\n    //The sticky behaviour is applied only to a limited set of dims\r\n    if (stickyDims.indexOf(dim) >= 0) {\r\n      //build the selection\r\n      dq.push(dim_selection(df_id, dim, selection));\r\n    } else {\r\n      dq.push('');\r\n    }\r\n  });\r\n\r\n  console.log(\"window.location.href\");\r\n  console.log(window.location.href);\r\n\r\n  //get the first part of the url\r\n  let oldUrl = window.location.href.split(\"?\")[0];\r\n\r\n  // let ret = `/resources/data_explorer/unicef_f/?ag=${dataflow.agencyID}&df=${dataflow.id}&ver=${\r\n  //   dataflow.version\r\n  // }`;\r\n  let ret = oldUrl + `?ag=${dataflow.agencyID}&df=${dataflow.id}&ver=${dataflow.version}`;\r\n\r\n  ret = ret + `&dq=${dq.join('.')}`;\r\n  ret = ret + `&startPeriod=${period[0]}&endPeriod=${period[1]}`;\r\n\r\n  return ret;\r\n};\r\n\r\n//The user selected an indicator, is it also contained in another Dataflow? (Selected node's parent == DATAFLOW_ID?)\r\nconst containsIndicators = (df_id, selItems) => {\r\n  if (!selItems) return false;\r\n  //If the selection does not contain an indicator return\r\n  const indDim = selItems.filter(ind => ind.id == 'INDICATOR');\r\n  if (indDim.length == 0) return false;\r\n\r\n  //if the parent id == the dataflow we're creating the link for then return true\r\n  for (let i = 0; i < indDim[0].values.length; i++) {\r\n    if (indDim[0].values[i].parentId == df_id) {\r\n      return true;\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\nconst isOnEvidence = (df_id, on_evidence) => {\r\n  if (!on_evidence) return null;\r\n  for (let i = 0; i < on_evidence.length; i++)\r\n    if (df_id == on_evidence[i].id) {\r\n      return on_evidence[i];\r\n    }\r\n  return null;\r\n};\r\n\r\n//A custom sort function: sorts the dataflows array keeping the ones onEvidence on top.\r\nconst dataflows_sort = (toSort, onEvidence) => {\r\n  toSort.sort(function (a, b) {\r\n    if (onEvidence.includes(a.id)) {\r\n      return -1;\r\n    }\r\n    if (onEvidence.includes(b.id)) {\r\n      return 1;\r\n    } else {\r\n      return a.name > b.name ? 1 : b.name > a.name ? -1 : 0;\r\n    }\r\n  });\r\n};\r\n\r\nconst DataflowNavigator = props => {\r\n  const dataflows = props.dataflows;\r\n\r\n  if (!dataflows) return <div />;\r\n\r\n  //filter/sort dataflows\r\n  const df_keys = [];\r\n  Object.keys(dataflows).forEach(df_key => {\r\n    //add only if the dataflow has been marked as Final\r\n    if (dataflows[df_key].isFinal) {\r\n      df_keys.push({ id: df_key, name: dataflows[df_key].name });\r\n    }\r\n  });\r\n\r\n  dataflows_sort(df_keys, props.dataflowsOnEvidence);\r\n\r\n  //For each dataflow loop the keys\r\n  const items = [];\r\n\r\n  df_keys.forEach(k => {\r\n    const df_key = k['id'];\r\n\r\n    let actionText = <FormattedMessage id=\"de.dataflowNavigator.findMoreData\" />;\r\n    const onEvidence = isOnEvidence(df_key, props.dataflowsOnEvidence);\r\n    if (onEvidence != null && onEvidence.actionText) {\r\n      actionText = onEvidence.actionText;\r\n    }\r\n\r\n    if (\r\n      df_key != props.dataflow.dataflowId &&\r\n      (containsIndicators(df_key, props.selItems) ||\r\n        isOnEvidence(df_key, props.dataflowsOnEvidence) != null)\r\n    ) {\r\n      items.push(\r\n        <div key={df_key} className=\"dfNav_item\">\r\n          <div className=\"dfNav_dfnametop\">{actionText}</div>\r\n          <div className=\"df_nav_dfname\">{dataflows[df_key].name}</div>\r\n          <div className=\"dfNav_link\">\r\n            <a\r\n              className=\"btn button\"\r\n              href={createLink(\r\n                df_key,\r\n                props.dataflows[df_key],\r\n                props.selItems,\r\n                props.period,\r\n                props.stickyDims,\r\n              )}\r\n            >\r\n              Go to dataset\r\n            </a>\r\n          </div>\r\n        </div>,\r\n      );\r\n    }\r\n  });\r\n\r\n  if (items.length == 0) {\r\n    return <div />;\r\n  }\r\n  return <div className=\"TableConfig_wrapper\">{items}</div>;\r\n};\r\n\r\nDataflowNavigator.propTypes = {\r\n  selItems: PropTypes.array,\r\n  dataflow: PropTypes.object,\r\n  dataflows: PropTypes.object,\r\n  period: PropTypes.array,\r\n  dataflowsOnEvidence: PropTypes.array,\r\n  stickyDims: PropTypes.array,\r\n};\r\n\r\nconst withProps = state => {\r\n  return {\r\n    selItems: getSelection(state),\r\n    dataflow: getDataflow(state),\r\n    dataflows: getDataflows(state),\r\n    period: getPeriod(state),\r\n  };\r\n};\r\n\r\nexport default connect(withProps)(DataflowNavigator);\r\n","import React, { Children } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport PropTypes from 'prop-types';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport FilterPeriod from '../FilterPeriod';\r\nimport FilterSelection from '../FilterSelection';\r\nimport Filters from '../Filters';\r\nimport Lastnobs from '../Lastnobs';\r\nimport DataflowNavigator from '../DataflowNavigator';\r\n\r\nimport { VXFilterContainerCollapsible } from '@sis-cc/dotstatsuite-ui-components';\r\n\r\n//settings\r\n\r\nclass NarrowFilters extends React.Component {\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      isOpen: false,\r\n      dateRangeIsOpen: false,\r\n    };\r\n  }\r\n\r\n  render() {\r\n    var toRender = null;\r\n    if (!this.state.isOpen) {\r\n      toRender = (\r\n        <button\r\n          className=\"narrow_btnOpenFilters\"\r\n          onClick={() => {\r\n            this.setState({ isOpen: true });\r\n          }}\r\n        >\r\n          <span className=\"pt-icon-standard pt-icon-settings\" />\r\n          <FormattedMessage id=\"vx.filters.filterdata\" />\r\n        </button>\r\n      );\r\n    } else {\r\n      toRender = (\r\n        <div>\r\n          <button\r\n            className=\"narrow_btnCloseFilters\"\r\n            onClick={() => {\r\n              this.setState({ isOpen: false });\r\n            }}\r\n          >\r\n            <FormattedMessage id=\"vx.filters.close\" />\r\n          </button>\r\n          {/*this.props.children*/}\r\n\r\n          <VXFilterContainerCollapsible titleLabel=\"Date range\" isOpen={false} noScroll={true}>\r\n            <Lastnobs />\r\n            <div style={this.props.lastnobs_active ? { opacity: 0.4, pointerEvents: 'none' } : {}}>\r\n              <FilterPeriod isNarrow={this.props.isNarrow} isRtl={this.props.isRtl} />\r\n            </div>\r\n          </VXFilterContainerCollapsible>\r\n\r\n          <VXFilterContainerCollapsible titleLabel=\"Disaggregations\" isOpen={false} noScroll={true}>\r\n            <FilterSelection isNarrow={this.props.isNarrow} isRtl={this.props.isRtl} />\r\n            <Filters isNarrow={this.props.isNarrow} isRtl={this.props.isRtl} />\r\n          </VXFilterContainerCollapsible>\r\n          <VXFilterContainerCollapsible\r\n            titleLabel=\"Explore other datasets\"\r\n            isOpen={false}\r\n            noScroll={true}\r\n          >\r\n            <DataflowNavigator\r\n              stickyDims={['REF_AREA', 'INDICATOR', 'SEX']}\r\n              dataflowsOnEvidence={[\r\n                { id: 'GLOBAL_DATAFLOW', actionText: 'Go to the Global Dataflow' },\r\n              ]}\r\n            />\r\n          </VXFilterContainerCollapsible>\r\n        </div>\r\n      );\r\n    }\r\n    return <div className=\"NarrowFilters\">{toRender}</div>;\r\n  }\r\n}\r\n\r\nNarrowFilters.propTypes = {\r\n  children: PropTypes.array,\r\n  isNarrow: PropTypes.bool,\r\n  isRtl: PropTypes.bool,\r\n  lastnobs_active: PropTypes.bool,\r\n};\r\n\r\nconst withProps = state => {\r\n  return {};\r\n};\r\n\r\nfunction mapDispatchToProps(dispatch, props) {\r\n  return {};\r\n}\r\n\r\nexport default connect(withProps, mapDispatchToProps)(NarrowFilters);\r\n","import * as R from 'ramda';\r\nimport { rules } from '@sis-cc/dotstatsuite-components';\r\n\r\nexport const defaultLayoutBuilder = dimensions => {\r\n  const ids = R.keys(dimensions);\r\n  const timeId = R.find(rules.isTimeDimension)(ids);\r\n  const areaId = R.find(rules.isAreaDimension)(ids);\r\n  const helper = (omitIds, pickId) =>\r\n    R.pipe(\r\n      R.omit(omitIds),\r\n      R.ifElse(R.has(pickId), R.prop(pickId), R.pipe(R.values, R.head)),\r\n      R.prop('id'),\r\n    );\r\n  const x = helper([], areaId)(dimensions);\r\n  const y = helper([areaId, x], timeId)(dimensions);\r\n  const z = R.pipe(R.omit([x, y]), R.values, R.pluck('id'))(dimensions);\r\n\r\n  return {\r\n    rows: R.ifElse(R.isNil, R.always([]), R.flip(R.append)([]))(x),\r\n    header: R.ifElse(R.isNil, R.always([]), R.flip(R.append)([]))(y),\r\n    sections: z,\r\n  };\r\n};\r\n\r\nexport const defaultConcat = (array1 = []) => (array2 = []) => R.concat(array2, array1);\r\nexport const deleteItem = (key, prop) =>\r\n  R.pipe(R.prop(key), R.filter(v => R.not(R.equals(v, prop))));\r\nexport const getValuesFlat = R.pipe(R.values, R.flatten);\r\n\r\nexport const adjustment = R.curry((notAvailableIds, layout) => {\r\n  const withoutNotAvailableIds = R.flip(R.difference)(notAvailableIds);\r\n  if (R.pipe(R.prop('rows'), withoutNotAvailableIds, R.isEmpty)(layout)) {\r\n    const pivot = R.pipe(R.prop('sections'), withoutNotAvailableIds, R.isEmpty)(layout)\r\n      ? 'header'\r\n      : 'sections';\r\n    const id = R.pipe(R.prop(pivot), withoutNotAvailableIds, R.head)(layout);\r\n    return R.pipe(R.assoc('rows', R.concat([id], R.propOr([], 'rows')(layout))), layout => ({\r\n      ...layout,\r\n      [pivot]: deleteItem(pivot, id)(layout),\r\n    }))(layout);\r\n  }\r\n  return layout;\r\n});\r\n\r\nexport const hasInvalidIds = layoutIds => R.pipe(R.flip(R.difference)(layoutIds), R.isEmpty, R.not);\r\nexport const isInvalid = (dimensionIds, layoutIds, layout) =>\r\n  R.or(hasInvalidIds(dimensionIds)(layoutIds), R.isEmpty(layout));\r\n\r\nexport const manyFormat = (format, timeDimensionInverted) =>\r\n  R.mapObjIndexed((dimension, id) => ({\r\n    id,\r\n    isTimePeriod: rules.isTimeDimension(id),\r\n    isTimeDimensionInverted: R.prop(id)(timeDimensionInverted),\r\n    label: format(dimension),\r\n    value: id,\r\n  }));\r\nexport const oneFormat = format =>\r\n  R.mapObjIndexed((dimension, id) => ({\r\n    id,\r\n    label: format(dimension),\r\n    value: id,\r\n    isOne: true,\r\n  }));\r\n\r\nexport const getDefaultLayout = (many, getMissingIds = []) => {\r\n  const defaultLayout = defaultLayoutBuilder(many);\r\n  const defaultMissingIds = R.pipe(getValuesFlat, getMissingIds)(defaultLayout);\r\n  return R.over(R.lensProp('sections'), defaultConcat(defaultMissingIds))(defaultLayout);\r\n};\r\nexport const getLayout = (missingIds, dimensionsIds) =>\r\n  R.pipe(R.over(R.lensProp('sections'), defaultConcat(missingIds)), adjustment(dimensionsIds));\r\n","import { createSelector } from 'reselect';\r\nimport * as R from 'ramda';\r\nimport { rules } from '@sis-cc/dotstatsuite-components';\r\nimport { getData, getLayout, getDimensions } from './sdmx';\r\nimport { getTimeDimensionInverted, getLayout as getVisLayout, getDimensionFormat } from './vis';\r\nimport { withIndex } from '../lib/utils';\r\nimport * as Layout from '../lib/layout';\r\nimport * as Sdmx from '../lib/sdmx';\r\n\r\nexport const getDataDimensions = () =>\r\n  createSelector(\r\n    getData,\r\n    R.pipe(\r\n      R.pathOr([], ['structure', 'dimensions', 'observation']),\r\n      R.addIndex(R.map)((dimension, index) =>\r\n        R.pipe(\r\n          R.assoc('index', index),\r\n          R.set(R.lensProp('values'), withIndex(R.propOr([], 'values')(dimension))),\r\n        )(dimension),\r\n      ),\r\n    ),\r\n  );\r\n\r\nexport const getVisDataDimensions = () =>\r\n  createSelector(\r\n    getDataDimensions(),\r\n    R.pipe(\r\n      R.partition(R.pipe(R.propOr([], 'values'), R.length, R.flip(R.gt)(1))),\r\n      R.converge(\r\n        (many, one) => ({\r\n          many: R.indexBy(R.prop('id'))(many),\r\n          one: R.indexBy(R.prop('id'))(one),\r\n        }),\r\n        [R.head, R.last],\r\n      ),\r\n    ),\r\n  );\r\n\r\nexport const getTableConfigDimensions = createSelector(\r\n  getVisDataDimensions(),\r\n  getDimensionFormat,\r\n  getTimeDimensionInverted,\r\n  ({ many, one }, format, timeDimensionInverted) =>\r\n    R.mergeRight(\r\n      Layout.oneFormat(format)(one),\r\n      Layout.manyFormat(format, timeDimensionInverted)(many),\r\n    ),\r\n);\r\n\r\nexport const getVisTableData = () =>\r\n  createSelector(getTimeDimensionInverted, getData, R.uncurryN(2, rules.getTableData));\r\n\r\n//export const getLimitedTo = ()=>{return getData;}\r\nexport const getLimited = () => {\r\n  //const r = R.pipe(getData,R.pathOr({limitedTo:0},['dataSets',0,'limited']));\r\n\r\n  if (R.isNil(getData)) {\r\n    return () => {\r\n      return { limitedTo: 0, returnedKeyCount: 0 };\r\n    };\r\n  }\r\n  const r = R.pipe(getData, R.pathOr({ limitedTo: 0 }, ['dataSets', 0, 'limited']));\r\n  return r;\r\n};\r\n//data.data.dataSets[0].limitedTo=keysLimit;\r\n\r\nexport const getFlatDimensionsIds = () =>\r\n  createSelector(getDimensions, getDataDimensions(), (structureDimensions, dataDimensions) =>\r\n    R.useWith(Sdmx.getUniq, [Sdmx.getDimensionsIds, Sdmx.getDimensionsIds])(\r\n      structureDimensions,\r\n      dataDimensions,\r\n    ),\r\n  );\r\n\r\nexport const getVisTableConfigLayout = () =>\r\n  createSelector(\r\n    getVisLayout,\r\n    getLayout,\r\n    getFlatDimensionsIds(),\r\n    getVisDataDimensions(),\r\n    (visLayout = {}, sdmxLayout = {}, dimensionsIds, { many, one }) => {\r\n      const layout = R.pipe(\r\n        R.ifElse(R.isEmpty, R.always(sdmxLayout), R.identity),\r\n        R.mergeRight({ sections: [], rows: [], header: [] }),\r\n      )(visLayout);\r\n      const getMissingIds = R.difference(dimensionsIds);\r\n      const oneIds = R.keys(one);\r\n      const layoutIds = Layout.getValuesFlat(layout);\r\n\r\n      if (Layout.isInvalid(dimensionsIds, layoutIds, layout))\r\n        return Layout.getDefaultLayout(many, getMissingIds);\r\n\r\n      const missingIds = getMissingIds(layoutIds);\r\n      if (R.isEmpty(missingIds)) return Layout.adjustment(oneIds, layout);\r\n\r\n      return Layout.getLayout(missingIds, oneIds)(layout);\r\n    },\r\n  );\r\n\r\nexport const getVisTableLayout = () =>\r\n  createSelector(getVisTableConfigLayout(), getVisDataDimensions(), (layout, { many }) => {\r\n    const idsNotInMany = R.difference(Layout.getValuesFlat(layout), R.keys(many));\r\n    return R.map(R.flip(R.difference)(idsNotInMany))(layout);\r\n  });\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { DETableConfig, VXFilterContainer } from '@sis-cc/dotstatsuite-ui-components';\r\n\r\nconst TableConfig = ({ title, ...tableProps }) => (\r\n  <VXFilterContainer titleLabel={title} noCollapse noScroll>\r\n    <DETableConfig {...tableProps} />\r\n  </VXFilterContainer>\r\n);\r\n\r\nTableConfig.propTypes = {\r\n  //title: PropTypes.object,\r\n  title: PropTypes.string,\r\n};\r\n\r\nexport default TableConfig;\r\n","import React from 'react';\r\nimport * as R from 'ramda';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps } from 'recompose';\r\nimport { FormattedMessage, injectIntl } from 'react-intl';\r\nimport { getDimensionGetter } from '../../selectors/vis';\r\nimport { getTableConfigDimensions, getVisTableConfigLayout } from '../../selectors/table';\r\nimport {\r\n  changeLayout,\r\n  changeDimensionGetter,\r\n  changeIsTimeDimensionInverted,\r\n} from '../../ducks/vis';\r\nimport { dimensionFormats } from '../../lib/utils';\r\nimport TableConfig from './TableConfig';\r\n\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      dimensions: getTableConfigDimensions,\r\n      dimensionGetter: getDimensionGetter,\r\n      layout: getVisTableConfigLayout(),\r\n    }),\r\n    { changeLayout, changeGetter: changeDimensionGetter, changeIsTimeDimensionInverted },\r\n  ),\r\n  injectIntl,\r\n  withProps(({ intl }) => ({\r\n    isNarrow: true,\r\n    noPreview: true,\r\n    title: '',\r\n    labels: {\r\n      commit: <FormattedMessage id=\"de.table.layout.apply\" />,\r\n      cancel: <FormattedMessage id=\"de.table.layout.cancel\" />,\r\n      row: <FormattedMessage id=\"de.table.layout.x\" />,\r\n      column: <FormattedMessage id=\"de.table.layout.y\" />,\r\n      section: <FormattedMessage id=\"de.table.layout.z\" />,\r\n      d: <FormattedMessage id=\"de.table.layout.getter.dimension\" />,\r\n      o: <FormattedMessage id=\"de.table.layout.getter.observation\" />,\r\n      time: <FormattedMessage id=\"de.table.layout.time\" />,\r\n      asc: <FormattedMessage id=\"de.table.layout.time.asc\" />,\r\n      desc: <FormattedMessage id=\"de.table.layout.time.desc\" />,\r\n      help: <FormattedMessage id=\"de.table.layout.help\" />,\r\n      table: <FormattedMessage id=\"de.table.layout.table\" />,\r\n      one: <FormattedMessage id=\"de.table.layout.value.one\" />,\r\n    },\r\n    dimensionGetters: R.reduce(\r\n      (memo, key) => ({ ...memo, [key]: intl.formatMessage({ id: `vx.config.display.${key}` }) }),\r\n      {},\r\n      R.keys(dimensionFormats),\r\n    ),\r\n  })),\r\n)(TableConfig);\r\n","import React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\n//temp disable the charts\r\n\r\nexport default [\r\n  /*\r\n  {\r\n    label: <FormattedMessage id=\"de.visualisation.toolbar.table\" />,\r\n    id: 'table',\r\n  },\r\n  {\r\n    label: <FormattedMessage id=\"de.visualisation.toolbar.chart\" />,\r\n    id: 'chart',\r\n    children: [\r\n      {\r\n        icon: 'timeline-line-chart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.timeline\" />,\r\n        id: 'TimelineChart',\r\n      },\r\n      {\r\n        icon: 'timeline-bar-chart',\r\n        id: 'BarChart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.bar\" />,\r\n      },\r\n      {\r\n        icon: 'horizontal-bar-chart',\r\n        id: 'RowChart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.row\" />,\r\n      },\r\n      /*{\r\n        icon: 'stacked-chart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.stacked\" />,\r\n        id: 'StackedBarChart',\r\n      },*/\r\n  /*],\r\n  },*/\r\n];\r\n","import React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport * as R from 'ramda';\r\n\r\nexport default ({ changeActionId, requestDataFile, dataflow, isFullscreen, isNarrow }) => {\r\n  const actions = [\r\n    /*{\r\n      icon: 'cog',\r\n      id: 'config',\r\n      label: <FormattedMessage id=\"de.visualisation.toolbar.action.customize\" />,\r\n      action: () => changeActionId('config'),\r\n    },*/\r\n    {\r\n      icon: 'import',\r\n      id: 'download',\r\n      label: <FormattedMessage id=\"de.visualisation.toolbar.action.download\" />,\r\n      children: [\r\n        {\r\n          id: 'csv-selection',\r\n          label: <FormattedMessage id=\"de.visualisation.toolbar.action.download.csv.selection\" />,\r\n          action: () => requestDataFile({ dataflow }),\r\n        },\r\n        {\r\n          id: 'csv-full',\r\n          label: <FormattedMessage id=\"de.visualisation.toolbar.action.download.csv.all\" />,\r\n          action: () => requestDataFile({ isDownloadAllData: true, dataflow }),\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      icon: isFullscreen ? 'minimize' : 'maximize',\r\n      id: 'fullscreen',\r\n      label: <FormattedMessage id=\"de.visualisation.toolbar.action.fullscreen\" />,\r\n      action: () => changeActionId('fullscreen'),\r\n    },\r\n  ];\r\n\r\n  const filtersBtn = {\r\n    icon: 'filter-list',\r\n    id: 'filters',\r\n    label: <FormattedMessage id=\"de.side.filters.action\" />,\r\n    action: () => changeActionId('filters'),\r\n  };\r\n\r\n  return R.pipe(R.ifElse(R.always(isNarrow), R.prepend(filtersBtn), R.identity))(actions);\r\n};\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps } from 'recompose';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { DEVisualisationToolbar } from '@sis-cc/dotstatsuite-ui-components';\r\nimport { getIsPending } from '../../selectors/app';\r\nimport { getDataflow } from '../../selectors/vis';\r\nimport { changeViewer, changeAction } from '../../ducks/vis';\r\nimport { requestDataFile } from '../../ducks/sdmx';\r\nimport menus from './menus';\r\nimport actions from './actions';\r\n\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      isDownloading: getIsPending('requestingDataFile'),\r\n      dataflow: getDataflow,\r\n    }),\r\n    { changeMenu: changeViewer, changeActionId: changeAction, requestDataFile },\r\n  ),\r\n  withProps(({ isDownloading, viewerId, actionId, ...rest }) => ({\r\n    loadingActionId: isDownloading ? 'download' : null,\r\n    selectedMenuId: viewerId,\r\n    selectedActionId: actionId,\r\n    actions: actions({ ...rest, viewerId }),\r\n    menus,\r\n    showLabel: <FormattedMessage id=\"de.visualisation.toolbar.show\" />,\r\n  })),\r\n)(DEVisualisationToolbar);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { VXFilterContainer } from '@sis-cc/dotstatsuite-ui-components';\r\nimport FilterPeriod from '../FilterPeriod';\r\nimport FilterSelection from '../FilterSelection';\r\nimport Filters from '../Filters';\r\nimport Toolbar from '../Toolbar';\r\nimport TableConfig from '../TableConfig';\r\n\r\nconst Tools = ({\r\n  isNarrow,\r\n  isRtl,\r\n  isFullscreen,\r\n  actionId,\r\n  /*isChartConfig,*/\r\n  isFilters,\r\n}) => (\r\n  <React.Fragment>\r\n    <Toolbar isNarrow={isNarrow} isRtl={isRtl} isFull={isFullscreen} actionId={actionId} />\r\n    {/*<VXFilterContainer isOpen={isChartConfig} noScroll noHeader>\r\n      <ChartConfig properties={properties} />\r\n    </VXFilterContainer>*/}\r\n    {isNarrow && (\r\n      <VXFilterContainer isOpen={isFilters} noScroll noHeader>\r\n        <FilterSelection isNarrow={isNarrow} isRtl={isRtl} />\r\n        <FilterPeriod isNarrow={isNarrow} isRtl={isRtl} />\r\n        <Filters isNarrow={isNarrow} isRtl={isRtl} />\r\n        <TableConfig isNarrow={isNarrow} isRtl={isRtl} />\r\n      </VXFilterContainer>\r\n    )}\r\n  </React.Fragment>\r\n);\r\n\r\nTools.propTypes = {\r\n  isNarrow: PropTypes.bool,\r\n  isRtl: PropTypes.bool,\r\n  isFullscreen: PropTypes.bool,\r\n  isChartConfig: PropTypes.bool,\r\n  isFilters: PropTypes.bool,\r\n  actionId: PropTypes.string,\r\n};\r\n\r\nexport default Tools;\r\n","import { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps } from 'recompose';\r\nimport * as R from 'ramda';\r\nimport { getViewer, getAction } from '../../selectors/vis';\r\nimport Tools from './Tools';\r\n\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      actionId: getAction,\r\n      viewerId: getViewer,\r\n    }),\r\n  ),\r\n  withProps(({ actionId, viewerId }) => ({\r\n    isChartConfig: R.equals('config', actionId) && !R.equals('table', viewerId),\r\n    isFilters: R.equals('filters', actionId),\r\n  })),\r\n)(Tools);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst FooterUnicef = ({ label, showCopyrightSymbol }) => {\r\n  let copy = '\\u00a9';\r\n  return (\r\n    <div className=\"div_footer\">\r\n      {showCopyrightSymbol ? copy : null}\r\n      {label}\r\n    </div>\r\n  );\r\n};\r\n\r\nFooterUnicef.propTypes = {\r\n  label: PropTypes.string,\r\n  showCopyrightSymbol: PropTypes.bool,\r\n};\r\n\r\nexport default FooterUnicef;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { DETableCell } from '@sis-cc/dotstatsuite-ui-components';\r\nimport glamorous from 'glamorous';\r\n\r\nconst StyledCell = glamorous.div(\r\n  {\r\n    width: '100%',\r\n    height: '100%',\r\n    padding: '4px 6px',\r\n    fontSize: 16,\r\n    textAlign: 'right',\r\n  },\r\n  ({ isYLast, isXLast, theme }) => ({\r\n    color: theme.table.oFont,\r\n    borderTop: `1px solid ${theme.table.border}`,\r\n    borderLeft: `1px solid ${theme.table.border}`,\r\n    borderRight: isYLast ? `1px solid ${theme.table.border}` : null,\r\n    borderBottom: isXLast ? null : `1px solid ${theme.table.border}`,\r\n    backgroundColor: theme.table.xBg,\r\n  }),\r\n);\r\n\r\nconst Cell = ({ renderObservation, variant }) => (\r\n  <React.Fragment>\r\n    <StyledCell isXLast isYLast>\r\n      <DETableCell value=\"Value\" variant={variant} />\r\n    </StyledCell>\r\n    <StyledCell isYLast>{renderObservation()}</StyledCell>\r\n  </React.Fragment>\r\n);\r\n\r\nCell.propTypes = {\r\n  renderObservation: PropTypes.func,\r\n  variant: PropTypes.string,\r\n};\r\n\r\nexport default Cell;\r\n","import React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\n//temp disable the charts\r\n\r\nexport default [\r\n  /*\r\n  {\r\n    label: <FormattedMessage id=\"de.visualisation.toolbar.table\" />,\r\n    id: 'table',\r\n  },\r\n  {\r\n    label: <FormattedMessage id=\"de.visualisation.toolbar.chart\" />,\r\n    id: 'chart',\r\n    children: [\r\n      {\r\n        icon: 'timeline-line-chart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.timeline\" />,\r\n        id: 'TimelineChart',\r\n      },\r\n      {\r\n        icon: 'timeline-bar-chart',\r\n        id: 'BarChart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.bar\" />,\r\n      },\r\n      {\r\n        icon: 'horizontal-bar-chart',\r\n        id: 'RowChart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.row\" />,\r\n      },\r\n      /*{\r\n        icon: 'stacked-chart',\r\n        label: <FormattedMessage id=\"de.visualisation.toolbar.chart.stacked\" />,\r\n        id: 'StackedBarChart',\r\n      },*/\r\n  /*],\r\n  },*/\r\n];\r\n","import React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { getHelpUrl } from '../../lib/settings';\r\n\r\nexport default ({ requestDataFile, requestExcelDataFile, dataflow }) => {\r\n  const actions = [\r\n    {\r\n      icon: 'import',\r\n      id: 'download',\r\n      label: <FormattedMessage id=\"de.visualisation.toolbar.action.download\" />,\r\n      children: [\r\n        {\r\n          id: 'excel-selection',\r\n          label: <FormattedMessage id=\"de.visualisation.toolbar.action.download.excel.selection\" />,\r\n          action: () => requestExcelDataFile({ dataflow }),\r\n        },\r\n        {\r\n          id: 'csv-selection',\r\n          label: <FormattedMessage id=\"de.visualisation.toolbar.action.download.csv.selection\" />,\r\n          action: () => requestDataFile({ dataflow }),\r\n        },\r\n        {\r\n          id: 'csv-full',\r\n          label: <FormattedMessage id=\"de.visualisation.toolbar.action.download.csv.all\" />,\r\n          action: () => requestDataFile({ isDownloadAllData: true, dataflow }),\r\n        },\r\n      ],\r\n    },\r\n  ];\r\n\r\n  /*\r\n  if (R.and(!R.isNil(getHelpUrl), !R.equals('', getHelpUrl))) {\r\n    actions.push({\r\n      icon: 'help',\r\n      id: 'help',\r\n      label: <FormattedMessage id=\"de.visualisation.toolbar.action.help\" />,\r\n      action: () => {\r\n        window.location = getHelpUrl;\r\n      },\r\n    });\r\n  }\r\n*/\r\n  return actions;\r\n};\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps } from 'recompose';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { DEVisualisationToolbar } from '@sis-cc/dotstatsuite-ui-components';\r\nimport { getIsPending } from '../../selectors/app';\r\nimport { getDataflow, getAction, getViewer } from '../../selectors/vis';\r\nimport { changeViewer, changeAction } from '../../ducks/vis';\r\nimport { requestDataFile, requestExcelDataFile } from '../../ducks/sdmx';\r\nimport menus from './menus';\r\nimport actions from './actions';\r\nimport * as R from 'ramda';\r\n\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      isDownloading: getIsPending('requestingDataFile'),\r\n      dataflow: getDataflow,\r\n      actionId: getAction,\r\n      viewerId: getViewer,\r\n    }),\r\n    {\r\n      changeMenu: changeViewer,\r\n      changeActionId: changeAction,\r\n      requestDataFile,\r\n      requestExcelDataFile,\r\n    },\r\n  ),\r\n  withProps(({ isDownloading, viewerId, actionId, ...rest }) => ({\r\n    loadingActionId: isDownloading ? 'download' : null,\r\n    selectedMenuId: viewerId,\r\n    selectedActionId: actionId,\r\n    actions: actions({ ...rest, viewerId }),\r\n    menus,\r\n    showLabel: <FormattedMessage id=\"de.visualisation.toolbar.show\" />,\r\n    isFilters: R.equals('filters', actionId),\r\n  })),\r\n)(DEVisualisationToolbar);\r\n","import React, { useEffect } from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst TableMessageUnicef = ({ returnedKeyCount, limitedTo, animationMillis }) => {\r\n  const msgBoxId = 'dataLimited_msgBox';\r\n\r\n  if (returnedKeyCount > limitedTo) {\r\n    const remMessage = () => {\r\n      document.getElementById('root').removeEventListener('data_loaded', remMessage);\r\n      const tmr = setTimeout(() => {\r\n        const el = document.getElementById(msgBoxId);\r\n        const onTransEnd = () => {\r\n          const el2 = document.getElementById(msgBoxId);\r\n          el2.removeEventListener('transitionend', onTransEnd);\r\n          el2.style.display = 'none';\r\n        };\r\n        if (el) {\r\n          el.addEventListener('transitionend', onTransEnd, false);\r\n          el.classList.add('dataLimited_msgBox_trans');\r\n        }\r\n      }, animationMillis);\r\n    };\r\n\r\n    document.getElementById('root').addEventListener('data_loaded', remMessage);\r\n  } else {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <div className=\"div_dataLimited\" id={msgBoxId} style={{ position: 'relative' }}>\r\n      <p>\r\n        Visualization is limited to {' ' + limitedTo} values to avoid slowing your browser.<br />\r\n        Please further filter your data, or &lt;Download&gt; the entire dataset as a CSV.\r\n      </p>\r\n      <div\r\n        style={{ position: 'absolute', top: '-20px', right: '-20px' }}\r\n        className=\"pt-tag-remove\"\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nTableMessageUnicef.propTypes = {\r\n  returnedKeyCount: PropTypes.number,\r\n  limitedTo: PropTypes.number,\r\n  animationMillis: PropTypes.number,\r\n};\r\n\r\nexport default TableMessageUnicef;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { SDMXTable } from '@sis-cc/dotstatsuite-ui-components';\r\nimport SisHeader from '@sis-cc/dotstatsuite-ui-header';\r\n//import SisFooter from '@sis-cc/dotstatsuite-ui-footer';\r\nimport FooterUnicef from '../FooterUnicef';\r\nimport glamorous from 'glamorous';\r\nimport Cell from './Cell';\r\n//import Tools from '../Tools';\r\nimport Toolbar from '../ToolbarUnicef';\r\nimport TableMessageUnicef from '../TableMessageUnicef';\r\nimport IndicatorLinkUnicef from '../IndicatorLinkUnicef';\r\n\r\nconst TableContainer = glamorous.div({\r\n  borderLeftWidth: 0,\r\n  borderRightWidth: 0,\r\n  marginTop: 10, // sync style with chart\r\n\r\n  overflowX: 'auto',\r\n});\r\n\r\nconst Table = ({\r\n  header,\r\n  viewerConfig,\r\n  data,\r\n  layoutIds,\r\n  renderObservation,\r\n  itemFormatter,\r\n  isNotATable,\r\n  footnotes,\r\n  variant,\r\n  limited,\r\n  selItems,\r\n}) => (\r\n  <TableContainer>\r\n    <div className=\"header_download\">\r\n      <SisHeader {...header} fonts={viewerConfig.fonts.header} />\r\n      <Toolbar />\r\n    </div>\r\n    <TableMessageUnicef\r\n      limitedTo={limited.limitedTo}\r\n      returnedKeyCount={limited.returnedKeyCount}\r\n      animationMillis={8000}\r\n    />\r\n    {/* <IndicatorLinkUnicef data={data} selItems={selItems} /> */}\r\n    {isNotATable ? (\r\n      <Cell renderObservation={renderObservation} variant={variant} />\r\n    ) : (\r\n      <SDMXTable\r\n        data={data}\r\n        layoutIds={layoutIds}\r\n        renderObservation={renderObservation}\r\n        itemFormatter={itemFormatter}\r\n      />\r\n    )}\r\n    <FooterUnicef label={'UNICEF'} showCopyrightSymbol={true} />\r\n  </TableContainer>\r\n);\r\n\r\nTable.propTypes = {\r\n  header: PropTypes.object,\r\n  viewerConfig: PropTypes.object,\r\n  source: PropTypes.object,\r\n  data: PropTypes.object,\r\n  footnotes: PropTypes.object,\r\n  layoutIds: PropTypes.object,\r\n  renderObservation: PropTypes.func,\r\n  itemFormatter: PropTypes.func,\r\n  isNotATable: PropTypes.bool,\r\n  variant: PropTypes.string,\r\n  limited: PropTypes.object,\r\n  selItems: PropTypes.array,\r\n};\r\n\r\nexport default Table;\r\n","import * as R from 'ramda';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, mapProps } from 'recompose';\r\nimport {\r\n  getVisDataDimensions,\r\n  getVisTableLayout,\r\n  getVisTableData,\r\n  getLimited,\r\n} from '../../selectors/table';\r\nimport { getDimensionFormat, getDimensionGetter } from '../../selectors/vis';\r\nimport { getCustomAttributes } from '../../selectors/sdmx';\r\nimport { rules } from '@sis-cc/dotstatsuite-components';\r\nimport { DETableCell } from '@sis-cc/dotstatsuite-ui-components';\r\nimport Table from './Table';\r\nimport { getSelection } from '../../selectors/sdmx';\r\n\r\nconst Cell = connect(createStructuredSelector({ variant: getDimensionGetter }))(DETableCell);\r\n\r\n/*export default compose(\r\n  connect(createStructuredSelector({ items: getSelection }), { changeFilters: changeDataquery }),\r\n  withProps({\r\n    titleLabel: <FormattedMessage id=\"vx.filters.current.title\" />,\r\n    clearAllLabel: <FormattedMessage id=\"vx.filters.current.clear\" />,\r\n    blankLabel: <FormattedMessage id=\"vx.filters.current.blank\" />,\r\n    noScroll: true,\r\n  }),\r\n  pure,\r\n)(VXFiltersCurrent);\r\n*/\r\n\r\n//Enque the unit multipliers to the unit. Hack to avoid altering the dotstatsuite-ui-header project\r\nconst addUnitMultiplierToUnit = (headerObj, footnotes) => {\r\n  //If the uprs(contains the unit) is empty return (the unit is not the same for the data shown)\r\n  if (headerObj.uprs == '') return headerObj;\r\n\r\n  let newUprs = headerObj.uprs;\r\n\r\n  //Append the multiplier if the unit is the same for all the data shown.\r\n  footnotes.footnotes.forEach(elem => {\r\n    if (elem.id == 'UNIT_MULTIPLIER' && elem.isFootnote) {\r\n      const mult = elem.values\r\n        .map(e => {\r\n          return e.name;\r\n        })\r\n        .join(', ');\r\n      newUprs = newUprs + ' (' + mult + ')';\r\n    }\r\n  });\r\n  headerObj.uprs = newUprs;\r\n  return headerObj;\r\n};\r\n\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      dimensions: getVisDataDimensions(),\r\n      customAttributes: getCustomAttributes,\r\n      layoutIds: getVisTableLayout(),\r\n      itemFormatter: getDimensionFormat,\r\n      data: getVisTableData(),\r\n      variant: getDimensionGetter,\r\n      limited: getLimited(),\r\n      selItems: getSelection,\r\n    }),\r\n  ),\r\n  mapProps(\r\n    ({\r\n      chartData,\r\n      viewerConfig,\r\n      data,\r\n      customAttributes,\r\n      dimensions,\r\n      layoutIds,\r\n      itemFormatter,\r\n      variant,\r\n      limited,\r\n      selItems,\r\n    }) => ({\r\n      viewerConfig,\r\n      data,\r\n      layoutIds,\r\n      itemFormatter,\r\n      renderObservation: rules.observationGetter(Cell)({\r\n        observations: R.prop('observations', data),\r\n        dimensions,\r\n        customAttributes,\r\n        isRtl: false,\r\n      })(R.identity),\r\n      // little dirty for now, in the wait of a better common mgmt of table and charts\r\n      //header: R.merge(R.pick(['title', 'subtitle', 'uprs'], chartData),R.pick(['footnotes'],customAttributes)),\r\n      header: addUnitMultiplierToUnit(\r\n        R.pick(['title', 'subtitle', 'uprs'], chartData),\r\n        R.pick(['footnotes'], customAttributes),\r\n      ),\r\n      footnotes: R.prop('footnotes', chartData),\r\n      isNotATable: R.pipe(R.prop('observations'), R.values, R.length, R.equals(1))(data),\r\n      variant,\r\n      limited,\r\n      selItems,\r\n    }),\r\n  ),\r\n)(Table);\r\n","import { Chart } from '@sis-cc/dotstatsuite-components';\r\nimport { mapProps } from 'recompose';\r\n\r\nexport default mapProps(({ chartData, chartOptions, viewerConfig, type }) => ({\r\n  data: chartData,\r\n  options: chartOptions,\r\n  config: viewerConfig,\r\n  type,\r\n}))(Chart);\r\n","const fonts = { fontFamily: 'Segoe UI' };\r\nconst fontDimensions = { fontFamily: 'Segoe UI', fontWeight: 500 };\r\n\r\nexport default {\r\n  owner: 'UNICEF',\r\n  logo: '',\r\n  footer_visible: false,\r\n  fonts: {\r\n    header: { subtitle: fontDimensions, title: fonts, uprs: fonts, tooltip: fonts },\r\n    chart: {\r\n      axisLegend: fonts,\r\n      chartLegend: fonts,\r\n      tooltip: { primary: fonts, secondary: fonts },\r\n    },\r\n    footer: { copyright: fonts, source: fonts },\r\n  },\r\n};\r\n","import React from 'react';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, branch, renderComponent, withProps } from 'recompose';\r\nimport * as R from 'ramda';\r\nimport { VXNoData } from '@sis-cc/dotstatsuite-ui-components';\r\nimport { getViewer } from '../../selectors/vis';\r\nimport Table from '../Table';\r\nimport Chart from '../Chart';\r\nimport viewerConfig from './config';\r\n\r\nexport default compose(\r\n  connect(createStructuredSelector({ type: getViewer })),\r\n  withProps({ viewerConfig }),\r\n  branch(\r\n    R.pipe(R.prop('data'), R.isNil),\r\n    renderComponent(() => <VXNoData message={<FormattedMessage id=\"vx.no.data\" />} />),\r\n  ),\r\n  branch(({ type }) => R.equals(type, 'table'), renderComponent(Table)),\r\n)(Chart);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport * as R from 'ramda';\r\nimport { VXFilterContainerCollapsible } from '@sis-cc/dotstatsuite-ui-components';\r\nimport List from '@material-ui/core/List';\r\nimport ListItem from '@material-ui/core/ListItem';\r\nimport ListItemText from '@material-ui/core/ListItemText';\r\nimport { FormattedMessage } from 'react-intl';\r\n\r\nconst Footnotes = ({ footnotes }) => (\r\n  <VXFilterContainerCollapsible\r\n    titleLabel={<FormattedMessage id=\"footnotes\" />}\r\n    isOpen={true}\r\n    noScroll\r\n  >\r\n    <List dense>\r\n      {R.map(({ id, label, values }) => (\r\n        <ListItem key={id}>\r\n          <ListItemText\r\n            primary={R.defaultTo(id, label)}\r\n            secondary={R.pipe(R.pluck('name'), R.join(' | '))(values)}\r\n          />\r\n        </ListItem>\r\n      ))(footnotes)}\r\n    </List>\r\n  </VXFilterContainerCollapsible>\r\n);\r\n\r\nFootnotes.propTypes = {\r\n  footnotes: PropTypes.array,\r\n};\r\n\r\nexport default Footnotes;\r\n","import * as R from 'ramda';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, mapProps } from 'recompose';\r\nimport { getCustomAttributes } from '../../selectors/sdmx';\r\nimport Footnotes from './Footnotes';\r\n\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      attributes: getCustomAttributes,\r\n    }),\r\n  ),\r\n  mapProps(\r\n    R.pipe(\r\n      R.prop('attributes'),\r\n      R.pick(['footnotes']),\r\n      R.prop('footnotes'),\r\n      R.reject(\r\n        R.pipe(\r\n          R.prop('id'),\r\n          R.flip(R.includes)(['UNIT_MEASURE']), // UNICEF specific\r\n        ),\r\n      ),\r\n      R.assoc('footnotes', R.__, {}),\r\n    ),\r\n  ),\r\n)(Footnotes);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport { VXLoader } from '@sis-cc/dotstatsuite-ui-components';\r\nimport { RulesDriver } from '@sis-cc/dotstatsuite-components';\r\nimport Tools from '../Tools';\r\nimport Viewer from '../Viewer';\r\nimport Footnotes from '../Footnotes';\r\n\r\nconst Main = ({\r\n  data,\r\n  enhancedData,\r\n  isRtl,\r\n  isNarrow,\r\n  isFullscreen,\r\n  isLoadingData,\r\n  display,\r\n  formaterIds,\r\n  type,\r\n  options,\r\n  dataUrl,\r\n}) => (\r\n  <RulesDriver\r\n    data={enhancedData}\r\n    display={display}\r\n    formaterIds={formaterIds}\r\n    type={type}\r\n    options={options}\r\n    sdmxUrl={dataUrl}\r\n    source={{ link: window.location.href }}\r\n    render={({ chartData, chartOptions, properties }) => (\r\n      <div>\r\n        {/* <Tools\r\n          isNarrow={isNarrow}\r\n          isRtl={isRtl}\r\n          isFullscreen={isFullscreen}\r\n          properties={properties}\r\n        /> */}\r\n        {isLoadingData && (\r\n          <VXLoader\r\n            isNarrow={isNarrow}\r\n            isRtl={isRtl}\r\n            loadingLabel={<FormattedMessage id=\"de.visualisation.data.loading\" />}\r\n            isLarge\r\n          />\r\n        )}\r\n        {!isLoadingData && (\r\n          <React.Fragment>\r\n            <Viewer\r\n              chartData={chartData}\r\n              chartOptions={chartOptions}\r\n              data={data}\r\n              isNarrow={isNarrow}\r\n              isRtl={isRtl}\r\n            />\r\n            <br />\r\n            <Footnotes />\r\n          </React.Fragment>\r\n        )}\r\n      </div>\r\n    )}\r\n  />\r\n);\r\n\r\nMain.propTypes = {\r\n  data: PropTypes.object,\r\n  enhancedData: PropTypes.object,\r\n  display: PropTypes.string,\r\n  formaterIds: PropTypes.object,\r\n  type: PropTypes.string,\r\n  options: PropTypes.object,\r\n  dataUrl: PropTypes.string,\r\n  isNarrow: PropTypes.bool,\r\n  isRtl: PropTypes.bool,\r\n  isLoadingData: PropTypes.bool,\r\n  isFullscreen: PropTypes.bool,\r\n};\r\n\r\nexport default Main;\r\n","import * as R from 'ramda';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, withProps } from 'recompose';\r\nimport { getData } from '../../selectors/sdmx';\r\nimport { getLocale, getIsPending } from '../../selectors/app';\r\nimport { getDisplay, getPeriod, getDataquery, getDataflow, getViewer } from '../../selectors/vis';\r\nimport { getDataUrl } from '../../lib/sdmx';\r\nimport { getSdmxAttribute, chartOptions } from '../../lib/settings';\r\nimport Main from './Main';\r\n\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      isLoadingData: getIsPending('getData'),\r\n      display: getDisplay,\r\n      type: getViewer,\r\n      data: getData,\r\n      dataflow: getDataflow,\r\n      dataquery: getDataquery,\r\n      locale: getLocale,\r\n      period: getPeriod,\r\n    }),\r\n  ),\r\n  withProps(({ data, dataflow, dataquery, locale, period }) => ({\r\n    dataUrl: getDataUrl({ configArgs: { dataflow, dataquery, locale }, requestArgs: { period } }),\r\n    options: chartOptions,\r\n    formaterIds: {\r\n      decimals: getSdmxAttribute('decimals'),\r\n      prefscale: getSdmxAttribute('prefscale'),\r\n    },\r\n    enhancedData: data,\r\n  })),\r\n)(Main);\r\n\r\n/*\r\nexport default compose(\r\n  connect(\r\n    createStructuredSelector({\r\n      isLoadingData: getIsPending('getData'),\r\n      display: getDisplay,\r\n      type: getViewer,\r\n      data: getData,\r\n      dataflow: getDataflow,\r\n      dataquery: getDataquery,\r\n      locale: getLocale,\r\n      period: getPeriod,\r\n    }),\r\n  ),\r\n  withProps(({ data, dataflow, dataquery, locale, period }) => ({\r\n    dataUrl: getDataUrl({ configArgs: { dataflow, dataquery, locale }, requestArgs: { period } }),\r\n    options: chartOptions,\r\n    formaterIds: {\r\n      decimals: getSdmxAttribute('decimals'),\r\n      prefscale: getSdmxAttribute('prefscale'),\r\n    },\r\n    enhancedData: R.over(\r\n      R.lensPath(['structure', 'dimensions', 'observation']),\r\n      //R.append({ id: 'FREQ', values: [{ id: 'A' }] }), is this hardcoded?\r\n      R.append({ id: 'Frequency', values: [{ id: 'Annual' }] }),\r\n      data,\r\n    ),\r\n  })),\r\n)(Main);\r\n*/\r\n","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport PropTypes from 'prop-types';\r\nimport { Tree } from '@blueprintjs/core';\r\nimport { getSelection } from '../../selectors/sdmx';\r\n\r\nimport { VXFilterContainerCollapsible } from '@sis-cc/dotstatsuite-ui-components';\r\n\r\n//TODO:\r\n//REMOVE HierarchicalCodelist (version1)\r\n//Make the dimension to attach the hierarchy to a param.\r\n//Disable the codes not in the codelist\r\n\r\nclass HierarchicalCodelist extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { expandedNodes: [], isOpen: false };\r\n  }\r\n\r\n  /*This doesn't get called... why?!?*/\r\n  onChangeIsOpen = () => {\r\n    //console.log('HEre');\r\n    this.setState({ isOpen: !this.state.isOpen });\r\n  };\r\n\r\n  handleNodeExpand = nodeData => {\r\n    nodeData.isExpanded = true;\r\n    this.setState({ expandedNodes: this.state.expandedNodes.concat(nodeData.id) });\r\n  };\r\n  handleNodeCollapse = nodeData => {\r\n    nodeData.isExpanded = false;\r\n\r\n    //this.setState(this.state);\r\n    const newExpanded = [...this.state.expandedNodes];\r\n    const idx = newExpanded.indexOf(nodeData.id);\r\n    if (idx >= 0) newExpanded.splice(idx, 1);\r\n    this.setState({ expandedNodes: newExpanded });\r\n  };\r\n\r\n  handleNodeClick = nodeData => {\r\n    this.props.changeSelection('REF_AREA', nodeData.codeID, this.props.dimensions);\r\n  };\r\n\r\n  expandNodes = (node, toExpand) => {\r\n    if (toExpand.includes(node.id)) {\r\n      node.isExpanded = true;\r\n    }\r\n    if (node.childNodes && node.childNodes.length > 0) {\r\n      node.childNodes.forEach(n => {\r\n        this.expandNodes(n, toExpand);\r\n      });\r\n    }\r\n  };\r\n\r\n  render() {\r\n    //Expand nodes\r\n    if (!this.props.hierarchy) return null;\r\n    if (this.props.hierarchy) {\r\n      this.props.hierarchy.forEach(n => {\r\n        this.expandNodes(n, this.state.expandedNodes);\r\n      });\r\n    }\r\n\r\n    const hierarchyName = this.props.hierarchyName;\r\n    if (hierarchyName == null) return null;\r\n\r\n    if (this.props.isCollapsible) {\r\n      return (\r\n        <div className=\"TableConfig_wrapper\">\r\n          <VXFilterContainerCollapsible\r\n            titleLabel={hierarchyName}\r\n            isOpen={this.state.isOpen}\r\n            noScroll={true}\r\n            onChangeIsOpen={this.onChangeIsOpen}\r\n          >\r\n            <Tree\r\n              className=\"hierarchy_tree\"\r\n              contents={this.props.hierarchy}\r\n              onNodeExpand={this.handleNodeExpand}\r\n              onNodeCollapse={this.handleNodeCollapse}\r\n              onNodeClick={this.handleNodeClick}\r\n            />\r\n          </VXFilterContainerCollapsible>\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div className=\"TableConfig_wrapper\">\r\n          {!this.props.isCollapsible && hierarchyName != null && <h6>{hierarchyName}</h6>}\r\n          <Tree\r\n            contents={this.props.hierarchy}\r\n            onNodeExpand={this.handleNodeExpand}\r\n            onNodeCollapse={this.handleNodeCollapse}\r\n            onNodeClick={this.handleNodeClick}\r\n          />\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nconst createTreeNode = (hierarchyNode, selCodes, codesInCodelist, depth = 0) => {\r\n  let isSelCode = false;\r\n  let selCodeParent = false;\r\n  let selCodeCount = 0;\r\n  let inCodelist = false;\r\n  if (selCodes && selCodes.length > 0 && selCodes.includes(hierarchyNode.codeID)) {\r\n    isSelCode = true;\r\n    selCodeParent = true;\r\n    selCodeCount++;\r\n  }\r\n  if (\r\n    codesInCodelist &&\r\n    codesInCodelist.length > 0 &&\r\n    codesInCodelist.includes(hierarchyNode.codeID)\r\n  ) {\r\n    inCodelist = true;\r\n  }\r\n\r\n  let childNodes = null;\r\n  if (hierarchyNode.codes && hierarchyNode.codes.length > 0) {\r\n    childNodes = [];\r\n    hierarchyNode.codes.forEach(c => {\r\n      const ch = createTreeNode(c, selCodes, depth + 1);\r\n      childNodes.push(ch);\r\n      selCodeParent = selCodeParent || ch.selCodeParent;\r\n      selCodeCount = selCodeCount + ch.selCodeCount;\r\n    });\r\n  }\r\n\r\n  const ret = {\r\n    id: hierarchyNode.id,\r\n    codeID: hierarchyNode.codeID,\r\n    label: hierarchyNode.name,\r\n    selCodeParent: selCodeParent,\r\n    selCodeCount: selCodeCount,\r\n\r\n    depth: depth,\r\n  };\r\n\r\n  if (selCodeParent && !isSelCode) {\r\n    ret.secondaryLabel = <span className=\"hier_selChildCount\">{selCodeCount}</span>;\r\n  }\r\n  if (isSelCode) {\r\n    ret.className = 'hier_sel';\r\n  } else {\r\n    ret.className = 'hier_unsel';\r\n  }\r\n  if (childNodes && childNodes.length > 0) {\r\n    ret['childNodes'] = childNodes;\r\n  }\r\n\r\n  return ret;\r\n};\r\n\r\nconst createTreeContents = (hierarchy, selItems, dims) => {\r\n  if (!hierarchy || !hierarchy.hierarchies) return [];\r\n\r\n  //MAKE dimIndex (INDEX) A PARAM\r\n  const dimIndex = 0;\r\n  const selCodes = [];\r\n\r\n  if (selItems && selItems.length > 0) {\r\n    selItems[dimIndex].values.forEach(v => {\r\n      selCodes.push(v.id);\r\n    });\r\n  }\r\n\r\n  const codesInCodelist = [];\r\n  if (dims[dimIndex]) {\r\n    dims[dimIndex].values.forEach(v => {\r\n      codesInCodelist.push(v.id);\r\n    });\r\n  }\r\n\r\n  const ret = [];\r\n  hierarchy.hierarchies.forEach(hi => {\r\n    ret.push(createTreeNode(hi, selCodes, codesInCodelist));\r\n  });\r\n\r\n  return ret;\r\n};\r\n\r\nHierarchicalCodelist.propTypes = {\r\n  hierarchy: PropTypes.array,\r\n  hierarchyName: PropTypes.string,\r\n  dimensions: PropTypes.array,\r\n  changeSelection: PropTypes.func,\r\n  selItems: PropTypes.array,\r\n  isCollapsible: PropTypes.bool,\r\n};\r\n\r\nconst mapStateToProps = (state, props) => {\r\n  return {\r\n    hierarchy: createTreeContents(state.sdmx.hierarchy, getSelection(state), state.sdmx.dimensions),\r\n    hierarchyName: state.sdmx.hierarchy ? state.sdmx.hierarchy.name : null,\r\n    dimensions: state.sdmx.dimensions,\r\n    selItems: getSelection(state),\r\n  };\r\n};\r\n\r\nfunction mapDispatchToProps(dispatch, props) {\r\n  //return bindActionCreators({incrementValue: incrementValue}, dispatch);\r\n  return {\r\n    changeSelection: (filterId, valueId, dims) =>\r\n      dispatch({\r\n        type: '@@vis/sdmx/CHANGE_DATAQUERY',\r\n        payload: { filterId, valueId, dimensions: dims },\r\n      }),\r\n  };\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(HierarchicalCodelist);\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { FormattedMessage } from 'react-intl';\r\nimport {\r\n  DELayout,\r\n  DELayoutContent,\r\n  DELayoutSide,\r\n  DELayoutMain,\r\n  VXLoader,\r\n  VXFilterContainerCollapsible,\r\n} from '@sis-cc/dotstatsuite-ui-components';\r\nimport NarrowFilters from '../NarrowFilters';\r\nimport FilterPeriod from '../FilterPeriod';\r\nimport FilterSelection from '../FilterSelection';\r\nimport Filters from '../Filters';\r\nimport TableConfig from '../TableConfig';\r\nimport Main from '../Main';\r\nimport Lastnobs from '../Lastnobs';\r\nimport DataflowNavigator from '../DataflowNavigator';\r\nimport HierarchicalCodelist2 from '../HierarchicalCodelist';\r\n\r\nconst App = ({\r\n  isNarrow,\r\n  isRtl,\r\n  isLoadingStructure,\r\n  isLoadingData,\r\n  isFullscreen,\r\n  lastnobs_active,\r\n}) => (\r\n  <DELayout isNarrow={isNarrow} isRtl={isRtl} isFull={isFullscreen}>\r\n    <DELayoutContent>\r\n      {isLoadingStructure && (\r\n        <VXLoader\r\n          isNarrow={isNarrow}\r\n          isRtl={isRtl}\r\n          loadingLabel={<FormattedMessage id=\"de.visualisation.loading\" />}\r\n          isLarge\r\n        />\r\n      )}\r\n    </DELayoutContent>\r\n    {!isLoadingStructure && (\r\n      <DELayoutSide>\r\n        {isNarrow && (\r\n          <NarrowFilters isNarrow={isNarrow} isRtl={isRtl} lastnobs_active={lastnobs_active} />\r\n        )}\r\n\r\n        {!isNarrow && (\r\n          <div>\r\n            <Lastnobs />\r\n            <div style={lastnobs_active ? { opacity: 0.4, pointerEvents: 'none' } : {}}>\r\n              <FilterPeriod isNarrow={isNarrow} isRtl={isRtl} />\r\n            </div>\r\n            <FilterSelection isNarrow={isNarrow} isRtl={isRtl} />\r\n            <Filters isNarrow={isNarrow} isRtl={isRtl} />\r\n\r\n            <HierarchicalCodelist2 isCollapsible={true} />\r\n\r\n            <div className=\"TableConfig_wrapper\">\r\n              <VXFilterContainerCollapsible\r\n                titleLabel={<FormattedMessage id=\"de.table.layout.title\" />}\r\n                isOpen={false}\r\n                noScroll={true}\r\n              >\r\n                {!isLoadingData && <TableConfig isRtl={isRtl} />}\r\n              </VXFilterContainerCollapsible>\r\n            </div>\r\n\r\n            <DataflowNavigator\r\n              stickyDims={['REF_AREA', 'INDICATOR', 'SEX']}\r\n              dataflowsOnEvidence={[\r\n                { id: 'GLOBAL_DATAFLOW', actionText: 'Go to the Global Dataflow' },\r\n              ]}\r\n            />\r\n            {/* <div className=\"TableConfig_wrapper\" /> */}\r\n          </div>\r\n        )}\r\n      </DELayoutSide>\r\n    )}\r\n    {!isLoadingStructure && (\r\n      <DELayoutMain>\r\n        <Main isNarrow={isNarrow} isRtl={isRtl} isFullscreen={isFullscreen} />\r\n      </DELayoutMain>\r\n    )}\r\n  </DELayout>\r\n);\r\n\r\nApp.propTypes = {\r\n  isNarrow: PropTypes.bool,\r\n  isRtl: PropTypes.bool,\r\n  isLoadingStructure: PropTypes.bool,\r\n  isLoadingData: PropTypes.bool,\r\n  isFullscreen: PropTypes.bool,\r\n  lastnobs_active: PropTypes.bool,\r\n};\r\n\r\nexport default App;\r\n","import * as R from 'ramda';\r\nimport { connect } from 'react-redux';\r\nimport { createStructuredSelector } from 'reselect';\r\nimport { compose, branch, renderNothing } from 'recompose';\r\nimport { getIsPending, getIsRtl } from '../../selectors/app';\r\nimport { getIsFullscreen, getDataflow, getLastnobservations } from '../../selectors/vis';\r\n\r\nimport withResponsiveness from '../../hocs/withResponsiveness';\r\nimport App from './App';\r\n\r\nexport default compose(\r\n  withResponsiveness,\r\n  connect(\r\n    createStructuredSelector({\r\n      isLoadingStructure: getIsPending('getStructure'),\r\n      isLoadingData: getIsPending('getData'),\r\n      isRtl: getIsRtl,\r\n      isFullscreen: getIsFullscreen,\r\n\r\n      dataflow: getDataflow,\r\n      lastnobs_active: getLastnobservations,\r\n      selItems: getSelection,\r\n    }),\r\n  ),\r\n  branch(R.pipe(R.prop('dataflow'), R.isNil), renderNothing),\r\n)(App);\r\n","import React from 'react';\r\nimport { render } from 'react-dom';\r\nimport { Provider } from 'react-redux';\r\nimport '@blueprintjs/core/dist/blueprint.css';\r\nimport { I18nProvider, initialize as initializeI18n } from './i18n';\r\nimport { createStore, reducer } from './core';\r\nimport ThemeProvider from './theme';\r\nimport ErrorBoundary from './components/Error';\r\nimport App from './components/App';\r\nimport { changeDataflow, loadDataflows, loadHierarchy } from './ducks/vis';\r\nimport './index.css';\r\nimport meta from '../../package.json';\r\n\r\nvar ES6_Error = false;\r\nif (!(typeof window.ES6_Error === 'undefined')) {\r\n  ES6_Error = window.ES6_Error;\r\n}\r\nif (ES6_Error) {\r\n  throw new Error('Browser not Supported');\r\n}\r\n\r\nconsole.info(`${meta.name}@${meta.version}`); // eslint-disable-line no-console\r\n\r\ninitializeI18n(window.SETTINGS.i18n);\r\nconst locale = window.SETTINGS.i18n.locales[window.SETTINGS.i18n.localeId];\r\n\r\nconst initialState = {\r\n  app: {\r\n    logs: [],\r\n    pending: {},\r\n    locale,\r\n  },\r\n  vis: {\r\n    filter: undefined, // id of the expanded filter: ''\r\n    viewer: 'table', // id of the viewer element to display\r\n    action: undefined, // id of the current tool action: ''\r\n    period: undefined, // period: [start, end]\r\n    dataflow: undefined, // dataflow identifiers: {datasourceId, dataflowId, agencyId, version}\r\n    isFullscreen: false, // fullscreen mode\r\n    dataquery: undefined, // dataquery: ''\r\n    display: 'label', // sdmx display mode: '' in label, code, both\r\n    timeDimensionInverted: { TIME_PERIOD: true }, // sdmx time direction: obj of bools, true asc - false desc\r\n    layout: undefined, // layout of the table\r\n    dimensionGetter: 'label', // accessor of the dimension for labelling,\r\n    lastnobservations: false, //is the lastnObservation option checked?\r\n  },\r\n  sdmx: {\r\n    dimensions: [],\r\n    data: undefined,\r\n    layout: {},\r\n    dataflows: {},\r\n  },\r\n};\r\nconst store = createStore(initialState, reducer);\r\n\r\nconsole.log('initialized with DATAFLOW:', window.DATAFLOW); // eslint-disable-line no-console\r\nstore.dispatch(changeDataflow(window.DATAFLOW));\r\nstore.dispatch(loadDataflows());\r\nif (window.SETTINGS.hierarchy && window.SETTINGS.hierarchy.agencyId) {\r\n  store.dispatch(loadHierarchy(window.SETTINGS, window.DATAFLOW));\r\n}\r\n\r\nconst ROOT = document.getElementById('root');\r\nROOT.addEventListener('unicef_changeDataflow', event =>\r\n  store.dispatch(changeDataflow(event.detail)),\r\n);\r\nconsole.log(`listen unicef_changeDataflow event`); // eslint-disable-line no-console\r\n\r\nrender(\r\n  <ErrorBoundary isFinal>\r\n    <Provider store={store}>\r\n      <ThemeProvider theme={{}} isRtl={locale.isRtl}>\r\n        <I18nProvider localeId={locale.id} messages={window.I18N}>\r\n          <ErrorBoundary>\r\n            <App />\r\n          </ErrorBoundary>\r\n        </I18nProvider>\r\n      </ThemeProvider>\r\n    </Provider>\r\n  </ErrorBoundary>,\r\n  ROOT,\r\n);\r\n","module.exports = __webpack_public_path__ + \"static/media/data-explorer-logo.707f6ef1.png\";"],"sourceRoot":""}